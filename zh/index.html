<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
	<meta name="generator" content="Hugo 0.129.0">
    
      <meta name="theme" content='FixIt v0.3.9'>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>*&lt;^_^&gt;*</title><meta name="author" content="caijin">
<meta name="author-link" content="https://caijin.dev">
<meta name="description" content="" />
  <meta itemprop="name" content="*&lt;^_^&gt;*">
  <meta itemprop="datePublished" content="2020-05-02T20:20:42+08:00">
  <meta itemprop="dateModified" content="2020-05-02T20:20:42+08:00"><meta property="og:url" content="https://caijin.dev/zh/">
  <meta property="og:site_name" content="*&lt;^_^&gt;*">
  <meta property="og:title" content="*&lt;^_^&gt;*">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="*&lt;^_^&gt;*">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://caijin.dev/zh/" /><link rel="alternate" href="/zh/index.xml" type="application/rss+xml" title="*&lt;^_^&gt;*">
  <link rel="feed" href="/zh/index.xml" type="application/rss+xml" title="*&lt;^_^&gt;*"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebSite",
    "url": "https:\/\/caijin.dev\/zh\/","inLanguage": "zh-CN","author": {
        "@type": "Person",
        "name": "caijin"
      },"license": "xxxx","name": "*\u003c^_^\u003e*"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/zh/" title="*&lt;^_^&gt;*"><span class="header-title-text">*&lt;^_^&gt;*</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item active">
              <a
                class="menu-link"
                href="/zh/"
                
                
              >æ–‡æ¡£</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/zh/categories/"
                
                
              >åˆ†ç±»</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/zh/tags/"
                
                
              >æ ‡ç­¾</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="https://github.com/CaiJinKen"
                
                rel="noopener noreferrer" target="_blank"
              ><i class="fa fa-heart" style="color:red"></i> github</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language-switch">
            <span role="button" aria-label="" title=""><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item">
                      <span class="menu-link text-secondary" title="ç®€ä½“ä¸­æ–‡">ç®€ä½“ä¸­æ–‡</span>
                    </li><li class="menu-item">
                      <a href="/en/" class="menu-link" title="English">English</a>
                    </li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/zh/" title="*&lt;^_^&gt;*"><span class="header-title-text">*&lt;^_^&gt;*</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item active"
            ><a
                  class="menu-link"
                  href="/zh/"
                  
                  
                >æ–‡æ¡£</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/zh/categories/"
                  
                  
                >åˆ†ç±»</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/zh/tags/"
                  
                  
                >æ ‡ç­¾</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="https://github.com/CaiJinKen"
                  
                  rel="noopener noreferrer" target="_blank"
                ><i class="fa fa-heart" style="color:red"></i> github</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title=""><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span><span class="menu-system-item language-switch">
              <span role="button" aria-label="" title="">ç®€ä½“ä¸­æ–‡<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select class="language-select" onchange="location = this.value;"><option value="/zh/" selected disabled>ç®€ä½“ä¸­æ–‡</option><option value="/en/">English</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><div class="page home posts"><article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/docker-&#43;-gitlab-&#43;-jenkins-%E6%90%AD%E5%BB%BA%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83/">Docker &#43; Gitlab &#43; Jenkins æ­å»ºæŒç»­é›†æˆç¯å¢ƒ</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:20:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">Docker + Gitlab + Jenkins æ­å»ºæŒç»­é›†æˆç¯å¢ƒ å®‰è£…docker sudo apt update sudo apt install apt-transport-https \ ca-certificates \ curl \ gnupg-agent \ software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository \ &#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \ $(lsb_release -cs) \ stable&#34; sudo apt update sudo apt install docker-ce docker-ce-cli containerd.ioå®‰è£…Gitlab sudo docker pull gitlab/gitlab-ce:nightlyç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå›½å†…æ‹‰å–æŸäº›é•œåƒæ…¢çš„ä¸€æ‰¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠdockeré•œåƒæºæ¢ä¸€ä¸‹ï¼Œ
sudo vim /etc/docker/daemon.jsonæˆ‘è¿™é‡Œæ›¿æ¢ä¸ºç½‘æ˜“å’Œç™¾åº¦çš„æºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ¢æˆä»»æ„ä½ æƒ³è¦çš„ä¸€ä¸ªæˆ–å¤šä¸ª
{ &#34;registry-mirrors&#34;: [ &#34;https://hub-mirror.c.163.com&#34;, &#34;https://mirror.baidubce.com&#34; ] }ä¹‹åï¼Œé‡å¯docker
sudo systemctl daemon-reload sudo systemctl restart dockeré•œåƒæ‹‰å–å¥½äº†ä»¥åï¼Œå¯åŠ¨å®¹å™¨</div><div class="post-footer">
    <a href="/zh/docker-&#43;-gitlab-&#43;-jenkins-%E6%90%AD%E5%BB%BA%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/others/' class="post-tag">Others</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/redis/redis-%E5%85%B6%E4%BB%96/">Rediså¿…çŸ¥å¿…ä¼š</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:20:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">Redis å…¶ä»– redis æ•°æ®æ·˜æ±°æœºåˆ¶ å½“æœºå™¨å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ï¼ˆè¾¾åˆ°ç‰©ç†æœºå™¨æˆ–è€…é…ç½®çš„å†…å­˜ä¸Šé™æ—¶ï¼‰ï¼Œredisä¼šä¾æ®æ•°æ®æ·˜æ±°æœºåˆ¶æ·˜æ±°ä¸€éƒ¨åˆ†æ•°æ®ï¼Œæœ‰ä»¥ä¸‹6ç§æ–¹å¼ï¼š
volatile-lruï¼š åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œä½¿ç”¨LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç®—æ³•ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyæ·˜æ±° volatile-ttlï¼š åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œæ ¹æ®TTLï¼ˆtime to liveï¼‰æ—¶é—´ï¼Œå°†å¿«è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±° volatile-randomï¼š åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ï¼Œéšæœºæ·˜æ±°æ•°æ® allkeys-lruï¼š åœ¨æ‰€æœ‰keyä¸­ï¼Œæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ® allkeys-randomï¼š åœ¨æ‰€æœ‰keyä¸­ï¼Œéšæœºæ·˜æ±°æ•°æ® noevictionï¼š ç¦æ­¢æ·˜æ±°æ•°æ® redisç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´© ç¼“å­˜ç©¿é€ï¼šè¯·æ±‚æ•°æ®åœ¨redisä¸­æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°ï¼Œæœ€åè¯·æ±‚è½åˆ°äº†æ•°æ®åº“ ç¼“å­˜å‡»ç©¿ï¼šçƒ­é—¨æ•°æ®çªç„¶å¤±æ•ˆï¼Œå¤§é‡è¯·æ±‚åˆ°äº†æ•°æ®åº“ ç¼“å­˜é›ªå´©ï¼šå¤§é‡æ•°æ®åŒæ—¶å¤±æ•ˆ Note: è§£å†³æ–¹æ¡ˆï¼š
ç©¿é€ï¼šå¯¹äºéæ³•å‚æ•°ï¼ˆegï¼šid&lt;=0ï¼‰å¢åŠ å‚æ•°æ ¡éªŒï¼Œè¿‡æ»¤æ‰ä¸å­˜åœ¨æ•°æ®çš„è¯·æ±‚ï¼›å¯¹äºåˆæ³•å‚æ•°(eg: id=xxxx)ï¼Œä½†æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼šå°†æ•°æ®è®¾ç½®ä¸ºnull å‡»ç©¿ï¼šè®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ é›ªå´©ï¼šé¿å…å¤§é‡æ•°æ®åŒä¸€æ—¶é—´è¿‡æœŸï¼šåˆ†æ•£è¿‡æœŸæ—¶é—´ï¼›åˆ†æ•£æ•°æ®åˆ°ä¸åŒç¼“å­˜æ•°æ®åº“ master-slave ä½œç”¨ï¼šä¸»ä»å¤‡ä»½ï¼Œé˜²æ­¢èŠ‚ç‚¹å®•æœºï¼›è¯»å†™åˆ†ç¦»ï¼Œè¾¾åˆ°è´Ÿè½½å‡è¡¡ç›®çš„ï¼Œæé«˜ç³»ç»Ÿååé‡ å…¨é‡åŒæ­¥ï¼Œå‘ç”Ÿåœ¨slaveåˆå§‹åŒ–é˜¶æ®µï¼š slaveè¿æ¥masterï¼Œå‘é€SYNCå‘½ä»¤ masteræ”¶åˆ°å‘½ä»¤åï¼Œå¼€å§‹æ‰§è¡ŒBGSAVEå‘½ä»¤ç”Ÿæˆrdbæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰€æ‰§è¡Œçš„_å†™å‘½ä»¤_ masteræ‰§è¡Œå®ŒBGSAVEå‘½ä»¤åï¼Œå‘æ‰€æœ‰slaveå‘é€rdbæ–‡ä»¶ slaveæ”¶åˆ°rdbæ–‡ä»¶åï¼Œä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„æ•°æ® masterå‘é€å®Œæ–‡ä»¶åï¼Œå°±å¼€å§‹æ”¾é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ slaveå®Œæˆæ•°æ®è½½å…¥åï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªmasteråŒæ­¥çš„å†™å‘½ä»¤ å¢é‡åŒæ­¥ï¼šslaveåˆå§‹åŒ–åæ­£å¸¸å·¥ä½œï¼Œæ¥æ”¶masterå‘é€çš„å†™å‘½ä»¤ã€‚masteræ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘slaveå‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œslaveæ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ åŒæ­¥ç­–ç•¥ï¼šmasterã€slaveåˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ï¼›å…¨é‡åŒæ­¥ç»“æŸåå¼€å§‹å¢é‡åŒæ­¥ã€‚å¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œslaveåœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚redisç­–ç•¥ä¸ºï¼Œé¦–å…ˆå…ˆè¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ </div><div class="post-footer">
    <a href="/zh/redis/redis-%E5%85%B6%E4%BB%96/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/redis/' class="post-tag">Redis</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/redis/redis%E6%8C%81%E4%B9%85%E5%8C%96/">RedisæŒä¹…åŒ–</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:20:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">redisæŒä¹…åŒ– ä¸¤ç§æ–¹å¼ï¼šRDBã€AOF
RDBï¼Œredis-databaseï¼Œä½¿ç”¨å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜çš„æ˜¯rediså†…å­˜ä¸­å®Œæ•´çš„æ•°æ®ï¼Œç›¸å½“äºæ•°æ®çš„å¿«ç…§ï¼Œé»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è‡ªåŠ¨æ‰§è¡Œ
SAVEå‘½ä»¤ï¼šä¼šé˜»å¡æœåŠ¡å™¨è¿›ç¨‹ï¼Œæ­¤æ—¶æ‰€æœ‰å‘½ä»¤éƒ½ä¼šä¸€ç›´é˜»å¡ç›´åˆ°saveå‘½ä»¤æ‰§è¡Œå®Œæ¯• BGSAVEå‘½ä»¤ï¼šä¼šé‡æ–°èµ·ä¸€ä¸ªè¿›ç¨‹å¤„ç†ï¼Œä¸ä¼šé˜»å¡ä»»ä½•å‘½ä»¤ æ¢å¤è¿‡ç¨‹ï¼š
å¦‚æœæ²¡å¼€å¯AOFæŒä¹…åŒ–ï¼ŒæœåŠ¡å™¨æ‰ä¼šä½¿ç”¨RDBæ–‡ä»¶è¿˜åŸæ•°æ® å¦‚æœå¼€å¯äº†AOFæŒä¹…åŒ–ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶è¿˜åŸæ•°æ® AOFï¼Œappend-only-fileï¼Œé»˜è®¤å…³é—­ï¼ŒæœåŠ¡å™¨åœ¨æ‰§è¡Œå®Œå†™å‘½ä»¤åï¼Œä¼šä»¥åè®®æ ¼å¼å°†å‘½ä»¤è¿½åŠ åˆ°AOFç¼“å†²åŒºï¼Œç„¶åæœåŠ¡å™¨æ ¹æ®appendfsyncé€‰é¡¹å†³å®šä½•æ—¶å°†AOFç¼“å†²åŒºå†…å®¹å†™å…¥åˆ°AOFæ–‡ä»¶ã€‚
appendfsyncï¼š
alwaysï¼Œæ¯ä¸ªå†™å‘½ä»¤éƒ½ä¼šåŒæ­¥åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œå³ä½¿æ•…éšœåœæœºï¼Œä¸¢å¤±æ•°æ®æœ€å¤šå°±ä¸€ä¸ªå†™å‘½ä»¤çš„æ•°æ® everysecï¼Œæ¯ç§’é’Ÿéƒ½ä¼šåŒæ­¥æ•°æ®åˆ°AOFæ–‡ä»¶ï¼Œæ•…éšœåœæœºæœ€å¤šå°±ä¸¢å¤±ä¸€ç§’é’Ÿçš„å†™å…¥å‘½ä»¤çš„æ•°æ®ï¼Œæ˜¯AOFæ–¹å¼çš„é»˜è®¤å€¼ noï¼Œä»ä¸åŒæ­¥æ•°æ®ï¼Œå‡ºç°æ•…éšœåï¼Œä¼šä¸¢å¤±ä¸Šæ¬¡åŒæ­¥ä¹‹åçš„æ‰€æœ‰å†™å…¥æ•°æ® æ¢å¤è¿‡ç¨‹ï¼š
åˆ›å»ºä¸€ä¸ªä¼ªå®¢æˆ·ç«¯ ä»AOFæ–‡ä»¶åˆ†æå¹¶è¯»å–ä¸€æ¡å†™å‘½ä»¤ ä¼ªå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ é‡å¤ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼Œç›´åˆ°AOFæ–‡ä»¶æ‰€æœ‰å†™å‘½ä»¤æ‰§è¡Œå®Œæ¯• éšç€è¿è¡Œæ—¶é—´çš„å¢åŠ ï¼ŒAOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œå ç”¨çš„ç£ç›˜ç©ºé—´ä¼šå¢åŠ ï¼Œè€Œä¸”æ•°æ®æ¢å¤çš„è¿‡ç¨‹æ‰€è€—è´¹çš„æ—¶é—´ä¹Ÿä¼šå¢åŠ ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œredisæä¾›äº†AOFé‡å†™åŠŸèƒ½ï¼šredisä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„AOFæ–‡ä»¶æ›¿ä»£ç°æœ‰AOFæ–‡ä»¶ï¼Œæ–°æ—§ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜çš„æ•°æ®ç›¸åŒï¼Œåªä¸è¿‡æ–°AOFæ–‡ä»¶ä¿å­˜çš„æ˜¯ç²¾ç®€åçš„å‘½ä»¤ï¼Œä¸ä¼šæµªè´¹å­˜å‚¨ç©ºé—´
AOFé‡å†™è¿‡ç¨‹ï¼š
æœåŠ¡å™¨åˆ›å»ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å¼€å§‹AOFæ–‡ä»¶é‡å†™ æœåŠ¡å™¨æ‰§è¡Œæ‰€æœ‰å‘½ä»¤å¤–è¿˜è¦å°†å†™å‘½ä»¤å†™å…¥AOFç¼“å†²åŒºå’ŒAOFé‡å†™ç¼“å†²åŒº å­è¿›ç¨‹å®ŒæˆAOFé‡å†™åå‘çˆ¶è¿›ç¨‹å‘é€ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°ä¿¡å·åï¼š å°†AOFé‡å†™ç¼“å†²åŒºå†…å®¹å†™å…¥åˆ°æ–°AOFæ–‡ä»¶ä¸­ï¼Œä¿è¯æ–°AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®å’ŒæœåŠ¡å™¨å½“å‰çš„æ•°æ®ä¸€è‡´ å¯¹æ–°AOFæ–‡ä»¶é‡å‘½åï¼Œè¦†ç›–ç°æœ‰AOFæ–‡ä»¶ï¼Œå®Œæˆæ–°æ—§AOFæ–‡ä»¶æ›¿æ¢ ä¸¤ç§æŒä¹…åŒ–æ–¹å¼çš„åŒºåˆ« å®ç°æ–¹å¼
RDBæŒä¹…åŒ–è®°å½•çš„æ˜¯ç»“æœï¼ŒAOFæŒä¹…åŒ–è®°å½•çš„æ˜¯è¿‡ç¨‹
æ–‡ä»¶ä½“ç§¯
è®°å½•ç»“æœçš„æ–¹å¼è‚¯å®šæ¯”è®°å½•è¿‡ç¨‹çš„æ–¹å¼å ç”¨çš„å­˜å‚¨ç©ºé—´å°ï¼Œå³ï¼šRDBæ–‡ä»¶å ç”¨çš„å­˜å‚¨ç©ºé—´å°
å®‰å…¨æ€§
AOFçš„å®‰å…¨æ€§è¦æ¯”RDBçš„é«˜ã€‚RDBæŒä¹…åŒ–ä¼šä¸¢å¤±ä»ä¸Šæ¬¡ä¿å­˜ä»¥åçš„æ•°æ®ï¼Œè€ŒAOFæŒä¹…åŒ–æœ€å¤šä¸¢å¤±1sçš„æ•°æ®
ä¼˜å…ˆçº§
AOFçš„ä¼˜å…ˆçº§æ¯”RDBçš„é«˜</div><div class="post-footer">
    <a href="/zh/redis/redis%E6%8C%81%E4%B9%85%E5%8C%96/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/redis/' class="post-tag">Redis</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/golang/unsafe.pointer/">Unsafe.Pointer</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:20:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">unsafe.Pointerç›¸å½“äºæŒ‡å‘ä»»æ„ç±»å‹çš„æŒ‡é’ˆ(*æŒ‡é’ˆ)ï¼Œä½†å®ƒæœ‰å››ç§ç‰¹æ®Šçš„æ“ä½œä¸åŒäºä¸€èˆ¬çš„æŒ‡é’ˆï¼š
ä»»æ„ç±»å‹çš„æŒ‡é’ˆ(*)å¯ä»¥è½¬æ¢ä¸ºPointer PointeræŒ‡é’ˆä¹Ÿå¯ä»¥è½¬æ¢ä¸ºä»»æ„ç±»å‹çš„æŒ‡é’ˆ uintptrå¯ä»¥è½¬æ¢æˆPointer Pointerå¯ä»¥ä¹Ÿå¯ä»¥è½¬æ¢ä¸ºuintptr å³:
Pointer &lt;&mdash;&gt;(*)
uintptr&lt;&mdash;-&gt; Pointer
Pointerå…è®¸ç¨‹åºå¿½ç•¥ç±»å‹æ£€æµ‹ä»è€Œè¯»å†™ä»»æ„çš„å†…å­˜ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨unsafeåŒ…çš„æ—¶å€™è¦æ ¼å¤–å°å¿ƒã€‚
æ¯”å¦‚å°†float64è½¬åŒ–ä¸ºint64ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯éœ€è¦éµå®ˆgoçš„ç±»å‹æ£€æµ‹ï¼Œè¿›è¡Œç±»å‹å¼ºè½¬ä¹‹åæ‰èƒ½æ­£å¸¸è¿è¡Œï¼š
var ( sourceValue float64 targetValue int46 ) sourceValue = 300.00 targetValue = int64(sourceValue) // targetValue = sourceValue //err: type not match ä½¿ç”¨ç¤ºä¾‹ï¼š
å°†*T1è½¬æ¢ä¸º*T2
func Float64bits(f float64) uint64{ return (*uint64)(unsafe.Pointer(&amp;f)) } //unsafe.Pointer(&amp;f)å³ç¬¬ä¸€æ¡è§„åˆ™ï¼šå°†ä»»æ„ç±»å‹æŒ‡é’ˆè½¬æ¢ä¸ºPointer //(*uint64)(unsafe.Pointer)å³ç¬¬äºŒæ¡è§„åˆ™ï¼šå°†Pointerè½¬æ¢ä¸ºä»»æ„ç±»å‹ å°†Pointerè½¬æ¢ä¸ºuintptr(å–åœ°å€å€¼)
func Pointer2uintptr(p unsafe.Pointer) uintprt{ return (uintptr)(p) } //(uintprt)(unsafe.Pointer)å³ç¬¬ä¸‰æ¡è§„åˆ™ï¼šå°†Pointerè½¬æ¢ä¸ºuintptr Note:ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦è¿™ä¹ˆç”¨ï¼Œå› ä¸ºuintptræœ¬è´¨ä¸Šæ˜¯æ•´æ•°ç±»å‹ï¼Œå½“Pointerä¸­çš„æŒ‡é’ˆå€¼å˜äº†ä»¥åï¼Œuintptrçš„å€¼å¹¶ä¸éšç€åŸå§‹æŒ‡é’ˆçš„å€¼å˜åŒ–ï¼Œè¿™é‡Œä»…ä»…åªæ˜¯å‡ºäºæ¼”ç¤ºçš„ç›®çš„è¿™ä¹ˆå†™ï¼Œæ‰€ä»¥åˆ«ç”¨ä»»ä½•å˜é‡ä¿å­˜Pointerè½¬æ¢ä¸ºuintpträ¹‹åçš„å€¼
å°†æŒ‡é’ˆå’Œåç§»åšè¿ç®—ä»¥åè¿”å›
p = unsafe.Pointer(uintptr(p)+offset) //offset æ˜¯ä¸€ä¸ªæ•´å‹çš„å€¼ï¼Œå¯ä»¥æ˜¯è®¡ç®—åçš„ï¼Œæ¯”å¦‚ //å¯¹äºç»“æ„ä½“ï¼š f = unsafe.Pointer(uintptr(unsafe.Pointer(&amp;s))+unsafe.Offsetof(s.f)) //ä¸Šé¢ç­‰åŒäº f = unsafe.Pointer(&amp;s.f) //å¯¹äºslice e := unsafe.</div><div class="post-footer">
    <a href="/zh/golang/unsafe.pointer/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/golang/' class="post-tag">Golang</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/golang/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/">Golangå†…å­˜å¯¹é½</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:18:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">golangå†…å­˜å¯¹é½ ä¸€ä¸ªgolangçš„ç»“æ„ä½“ï¼Œåœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜æ”¾çš„å‘¢ï¼Ÿå³ï¼Œç»“æ„ä½“çš„å†…å­˜ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¼˜åŒ–çš„ç©ºé—´å‘¢ï¼Ÿä»Šå¤©æ¥ä¸€æ¢ç©¶ç«Ÿ
note:æˆ‘æ‰€ç”¨çš„æ˜¯64biteçš„æœºå™¨ï¼Œåœ¨32ä½çš„æœºå™¨æœ‰äº›ç±»å‹çš„å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚int
åŸºæœ¬æ•°æ®ç±»å‹çš„å¤§å°
var ( boolField bool byteField byte int8Field int8 int16Field int16 int32Field int32 intField int int64Field int64 float32Field float32 float64Field float64 stringField string mapField map[string]interface{} sliceField []interface{} ) fmt.Println(unsafe.Sizeof(boolField)) //1 fmt.Println(unsafe.Sizeof(byteField)) //1 fmt.Println(unsafe.Sizeof(int8Field)) //1 fmt.Println(unsafe.Sizeof(int16Field)) //2 fmt.Println(unsafe.Sizeof(int32Field)) //4 fmt.Println(unsafe.Sizeof(intField)) //8 fmt.Println(unsafe.Sizeof(int64Field)) //8 fmt.Println(unsafe.Sizeof(float32Field)) //4 fmt.Println(unsafe.Sizeof(float64Field)) //8 fmt.Println(unsafe.Sizeof(stringField)) //16 fmt.Println(unsafe.Sizeof(mapField)) //8 fmt.Println(unsafe.Sizeof(sliceField)) //24 note: unsafe.Sizeof()è¿”å›çš„æ˜¯å­—èŠ‚æ•°ï¼Œå¦‚æœæœ‰è¿™ä¹ˆä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒæ‰€å ç”¨çš„å†…å­˜æ˜¯28Bä¹ˆï¼Ÿ
type testStruct struct { boolField bool stringField string byteField byte int64Field int64 int16Field int16 }è¿è¡Œä¸€ä¸‹çœ‹çœ‹ï¼š</div><div class="post-footer">
    <a href="/zh/golang/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/golang/' class="post-tag">Golang</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/kafka/kafka/">Kafkaç®€ä»‹</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:18:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">Kafka ä¸€ã€åŸºæœ¬æ¦‚å¿µ kafka clusterï¼škafkaé›†ç¾¤ï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªå®ä¾‹ï¼ˆbrokerï¼‰ç»„æˆï¼Œé€šè¿‡zookeeperè¿›è¡Œå…ƒæ•°æ®ï¼ˆbrokerIDã€broker åœ°å€ç­‰ä¿¡æ¯ï¼Œpartitionçš„leaderã€followerä¿¡æ¯ç­‰ï¼‰å…±äº«ä¸åŒæ­¥ brokerï¼škafkaé›†ç¾¤ä¸­çš„ä¸€ä¸ªkafkaæœåŠ¡å®ä¾‹ï¼Œé›†ç¾¤å†…æ¯ä¸ªbrokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚broker-0ã€broker-1 producerï¼šæ¶ˆæ¯ç”Ÿäº§è€… topicï¼šæ¶ˆæ¯ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯åˆ†ç±»ï¼Œä¸ºé€»è¾‘æ¦‚å¿µã€‚Kafkaçš„æ¶ˆæ¯å°±ä¿å­˜åœ¨topicï¼Œæ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚ partitionï¼štopicçš„åˆ†åŒºï¼Œæ¯ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºçš„ä½œç”¨æ˜¯åšè´Ÿè½½ï¼Œæé«˜Kafkaçš„ååé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒåˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„ï¼Œpartitionçš„è¡¨ç°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºç‰©ç†æ¦‚å¿µã€‚ replicationï¼šåˆ†åŒºçš„å‰¯æœ¬ï¼Œå‰¯æœ¬çš„ä½œç”¨å°±æ˜¯æé«˜Kafkaçš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚åŒä¸€ä¸ªpartitionæœ‰å¤šä¸ªreplicationçš„æƒ…å†µä¸‹ï¼Œä¼šé€šè¿‡zookeeperé€‰å‡ºä¸€ä¸ªleaderï¼Œå…¶ä½™çš„ä¸ºfollowerï¼Œproducer/consumer è¯»å†™partitionçš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡leaderè¿›è¡Œçš„ã€‚å½“leaderä¸å¯ç”¨æ—¶ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªfolloweræˆä¸ºleaderã€‚åœ¨Kafkaä¸­ï¼Œé»˜è®¤çš„æœ€å¤§å‰¯æœ¬æ•°é‡æ˜¯10ä¸ªï¼Œè€Œä¸”å‰¯æœ¬çš„æ•°é‡ä¸èƒ½è¶…è¿‡brokeræ•°é‡ consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€… consumer groupï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ç»„ã€‚ä¸ºäº†æé«˜Kafkaçš„ååé‡ã€‚å¯ä»¥å°†å¤šä¸ªconsumerç»„æˆä¸€ä¸ªgroupï¼ŒåŒä¸€ä¸ªpartitionæ•°æ®åªèƒ½è¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ã€‚åŒä¸€ä¸ªgroupé‡Œçš„consumerå¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªtopicçš„ä¸åŒåˆ†åŒºçš„æ•°é‡ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ä¿è¯ï¼ŒåŒä¸€æ¶ˆæ¯ï¼Œä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ äºŒã€Kafkaæ ¸å¿ƒè§„åˆ™ å·¥ä½œæµç¨‹
producerå…ˆä»é›†ç¾¤ä¸­è·å–åˆ†åŒºçš„leader producerå°†æ¶ˆæ¯å‘é€ç»™leader leaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶ followerä»leader pull æ¶ˆæ¯ followerå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶åï¼Œå‘leaderå‘é€ACK leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ACKåï¼Œå‘producerå‘é€ACK æ¯æ¡æ¶ˆæ¯æ˜¯è¿½åŠ åˆ°åˆ†åŒºä¸­ï¼Œé¡ºåºå†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥ä¿è¯åŒä¸€åˆ†åŒºçš„æ•°æ®æ˜¯æœ‰åºçš„ produceré‡‡ç”¨pushæ¨¡å¼å°†æ¶ˆæ¯å‘å¸ƒåˆ°broker followeræ˜¯ä¸»åŠ¨å»leader pullæ¶ˆæ¯è¿›è¡ŒåŒæ­¥çš„ producerå¦‚ä½•ç¡®å®šæ•°æ®è¯¥å†™åˆ°é‚£ä¸ªpartition partitionåœ¨å†™å…¥çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦å†™å…¥çš„partitionï¼›å¦‚æœæŒ‡å®šï¼Œåˆ™å†™å…¥å¯¹åº”çš„partition å¦‚æœæ²¡æœ‰æŒ‡å®špartitionï¼Œä½†æ˜¯è®¾ç½®äº†keyï¼Œåˆ™ä¼šæ ¹æ®keyçš„å€¼hashåˆ°ä¸€ä¸ªpartition å¦‚æœæ—¢æ²¡æœ‰partitionï¼Œä¹Ÿæ²¡æœ‰keyï¼Œåˆ™ä¼šè½®è¯¢é€‰å‡ºä¸€ä¸ªpartition å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼šproducerå†™å…¥æ¶ˆæ¯ã€followeråŒæ­¥leaderæ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›ACKï¼Œé€šè¿‡ACKåº”ç­”æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢ã€‚åœ¨ç”Ÿäº§è€…å‘kafkaå†™æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥è®¾å®šå‚æ•°acksæ¥ç¡®å®škafkaæ˜¯å¦ç¡®è®¤æ”¶åˆ°æ•°æ®ï¼Œè¿™ä¸ªå€¼å¯ä»¥è®¾ç½®ä¸º0ã€1ã€all
0ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusterä¸éœ€è¦ç­‰åˆ°clusterè¿”å›ACKæ¶ˆæ¯ï¼Œæ‰€ä»¥è®¾ç½®è¿™ä¸ªå€¼ä¸èƒ½ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå®‰å…¨æ€§æœ€ä½ï¼Œä½†æ˜¯æ•ˆç‡æœ€é«˜ 1ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œåªè¦leaderåº”ç­”å°±å¯ä»¥å‘é€ä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥è¿™ä¸ªè®¾ç½®åªèƒ½ç¡®ä¿å‘é€ç»™leaderæˆåŠŸ allä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œéœ€è¦æ‰€æœ‰çš„followeréƒ½å®Œæˆä»leaderåŒæ­¥ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€æ¡ï¼Œç¡®ä¿leaderå‘é€æˆåŠŸå¹¶ä¸”æ‰€æœ‰followeréƒ½å®Œæˆå¤‡ä»½ã€‚å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯æ•ˆç‡æœ€ä½ æ•°æ®ä¿å­˜
partitionç»“æ„ï¼šæ¯ä¸ªpartitionæ–‡ä»¶å¤¹ç”±å¤šä¸ªsegmentæ–‡ä»¶ç»„æˆï¼Œæ¯ç»„segmentæ–‡ä»¶åŒ…å«.indexã€.logæ–‡ã€.timeindexä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­.indexã€.logæ–‡ä»¶ä¸ºç´¢å¼•æ–‡ä»¶ï¼Œlogæ–‡ä»¶å°±æ˜¯å­˜å‚¨messageçš„åœ°æ–¹ã€‚Kafkaå°±æ˜¯åˆ©ç”¨segment+indexçš„æ–¹å¼è§£å†³æŸ¥è¯¢æ•ˆç‡ä½é—®é¢˜ messageç»“æ„ï¼šmessageä¸»è¦åŒ…å«æ¶ˆæ¯ä½“ã€æ¶ˆæ¯å¤§å°ã€offsetã€å‹ç¼©ç±»å‹ç­‰ä¿¡æ¯ å­˜å‚¨ç­–ç•¥ï¼šæ— è®ºmessageæ˜¯å¦è¢«æ¶ˆè´¹ï¼ŒKafkaéƒ½ä¼šä¿å­˜æ‰€æœ‰æ¶ˆæ¯ï¼Œå¯¹äºæ—§æ•°æ®åˆ é™¤ç­–ç•¥æœ‰ä¸¤ç§ï¼šåŸºäºæ—¶é—´ï¼Œé»˜è®¤7å¤©ï¼›åŸºäºå¤§å°ï¼Œé»˜è®¤1GBã€‚ consumer groupä¸­consumerå’Œpartitionçš„å…³ç³»ï¼š
ä¸€ä¸ªconsumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionä¸­çš„æ•°æ® ä¸€ä¸ªpartitionåªèƒ½è¢«ä¸€ä¸ªconsumeræ¶ˆè´¹ ä¸‰ã€Kafkaååé‡å¤§çš„åŸå›  å››ã€QA leaderçš„é€‰ä¸¾
kafkaä¸æ˜¯å¤šæ•°æŠ•ç¥¨é€‰ä¸¾leaderã€‚kafkaåŠ¨æ€ç»´æŠ¤ä¸€ç»„åŒæ­¥leaderæ•°æ®çš„å‰¯æœ¬ï¼ˆISR in-sync-replicationï¼‰ï¼Œåªæœ‰è¿™ä¸ªç»„çš„æˆå‘˜æ‰æœ‰èµ„æ ¼å½“é€‰leaderï¼Œkafkaå‰¯æœ¬å†™å…¥ä¸è¢«è®¤ä¸ºæ˜¯å·²æäº¤ï¼Œç›´åˆ°æ‰€æœ‰çš„åŒæ­¥å‰¯æœ¬å·²ç»æ¥æ”¶æ‰è®¤ä¸ºã€‚è¿™ç»„ISRä¿å­˜åœ¨zookeeperï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ISRä¸­çš„ä»»ä½•å‰¯æœ¬éƒ½æœ‰èµ„æ ¼å½“é€‰leaderï¼Œè¿™æ˜¯kafkaçš„ä½¿ç”¨æ¨¡å‹ï¼Œæœ‰å¤šä¸ªåˆ†åŒºå’Œç¡®ä¿leaderå¹³è¡¡æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æœ‰äº†è¿™ä¸ªæ¨¡å‹ï¼ŒISRå’Œf+1å‰¯æœ¬ï¼Œkafkaçš„ä¸»é¢˜å¯ä»¥å®¹å¿få¤±è´¥è€Œä¸ä¼šä¸¢å¤±å·²æäº¤çš„æ¶ˆæ¯ã€‚
æˆä¸ºISRåˆ—è¡¨ä¸­çš„ä¸€å‘˜ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
å‰¯æœ¬èŠ‚ç‚¹å¿…é¡»èƒ½ä¸zookeeperä¿æŒä¼šè¯ï¼ˆå¿ƒè·³æœºåˆ¶ğŸ’—ï¼‰ å‰¯æœ¬èƒ½å¤Ÿå¤åˆ¶leaderä¸Šçš„æ‰€æœ‰å†™æ“ä½œï¼Œå¹¶ä¸”ä¸èƒ½è½åå¤ªå¤šï¼ˆå¡ä½æˆ–æ»åçš„å‰¯æœ¬ç”±replica.lag.time.max.msé…ç½®ï¼‰ ä¸€æ—¦followerä»leaderåŒæ­¥æ•°æ®çš„å»¶è¿Ÿè¶…è¿‡é˜€å€¼ï¼Œleaderå°±ä¼šæŠŠå®ƒä»ISRä¸­å‰”é™¤ï¼Œæ”¾å…¥OSRï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šåŠ å…¥OSR
AR(assigned replicas) = ISR+OSR (out of-sync-replicas)
å¦‚ä½•ä¿è¯å·²æäº¤çš„ä¿¡æ¯ä¸ä¸¢å¤±
replication+leaderé€‰ä¸¾æœºåˆ¶</div><div class="post-footer">
    <a href="/zh/kafka/kafka/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/kafka/' class="post-tag">Kafka</a></div></div>
</article>
<ul class="pagination"><li class="page-item active">
          <span class="page-link">
            <a href="/zh/">1</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/zh/page/2/">2</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/zh/page/3/">3</a>
          </span>
        </li></ul></div></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered order-2">
        </div><div class="footer-line copyright order-1" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">
              <a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer">caijin</a></span><span class="license footer-divider">MIT</span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label=""><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning"></div>
  </noscript>
</div><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/js/flyfish.js" defer></script><script>window.config={"code":{"copyTitle":"","editLockTitle":"","editUnLockTitle":"","editable":true,"maxShownLines":10},"cookieconsent":{"content":{"dismiss":"","link":"","message":""},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
