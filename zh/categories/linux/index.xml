<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
  <channel>
    <title>Linux - category - *&lt;^_^&gt;*</title>
    <link>https://caijin.dev/zh/categories/linux/</link>
    <description>Linux - category | *&lt;^_^&gt;*</description>
    <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>xxxx</copyright><lastBuildDate>Sat, 02 May 2020 20:18:42 &#43;0800</lastBuildDate><atom:link href="https://caijin.dev/zh/categories/linux/" rel="self" type="application/rss+xml" /><item>
  <title>kafkaç®€ä»‹</title>
  <link>https://caijin.dev/zh/kafka/kafka/</link>
  <pubDate>Sat, 02 May 2020 20:18:42 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/kafka/kafka/</guid>
  <description><![CDATA[Kafka ä¸€ã€åŸºæœ¬æ¦‚å¿µ kafka clusterï¼škafkaé›†ç¾¤ï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªå®žä¾‹ï¼ˆbrokerï¼‰ç»„æˆï¼Œé€šè¿‡zookeeperè¿›è¡Œå…ƒæ•°æ®ï¼ˆbrokerIDã€broker åœ°å€ç­‰ä¿¡æ¯ï¼Œpartitionçš„leaderã€followerä¿¡æ¯ç­‰ï¼‰å…±äº«ä¸ŽåŒæ­¥ brokerï¼škafkaé›†ç¾¤ä¸­çš„ä¸€ä¸ªkafkaæœåŠ¡å®žä¾‹ï¼Œé›†ç¾¤å†…æ¯ä¸ªbrokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚broker-0ã€broker-1 producerï¼šæ¶ˆæ¯ç”Ÿäº§è€… topicï¼šæ¶ˆæ¯ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯åˆ†ç±»ï¼Œä¸ºé€»è¾‘æ¦‚å¿µã€‚Kafkaçš„æ¶ˆæ¯å°±ä¿å­˜åœ¨topicï¼Œæ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚ partitionï¼štopicçš„åˆ†åŒºï¼Œæ¯ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºçš„ä½œç”¨æ˜¯åšè´Ÿè½½ï¼Œæé«˜Kafkaçš„åžåé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒåˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„ï¼Œpartitionçš„è¡¨çŽ°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºç‰©ç†æ¦‚å¿µã€‚ replicationï¼šåˆ†åŒºçš„å‰¯æœ¬ï¼Œå‰¯æœ¬çš„ä½œç”¨å°±æ˜¯æé«˜Kafkaçš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚åŒä¸€ä¸ªpartitionæœ‰å¤šä¸ªreplicationçš„æƒ…å†µä¸‹ï¼Œä¼šé€šè¿‡zookeeperé€‰å‡ºä¸€ä¸ªleaderï¼Œå…¶ä½™çš„ä¸ºfollowerï¼Œproducer/consumer è¯»å†™partitionçš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡leaderè¿›è¡Œçš„ã€‚å½“leaderä¸å¯ç”¨æ—¶ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªfolloweræˆä¸ºleaderã€‚åœ¨Kafkaä¸­ï¼Œé»˜è®¤çš„æœ€å¤§å‰¯æœ¬æ•°é‡æ˜¯10ä¸ªï¼Œè€Œä¸”å‰¯æœ¬çš„æ•°é‡ä¸èƒ½è¶…è¿‡brokeræ•°é‡ consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€… consumer groupï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ç»„ã€‚ä¸ºäº†æé«˜Kafkaçš„åžåé‡ã€‚å¯ä»¥å°†å¤šä¸ªconsumerç»„æˆä¸€ä¸ªgroupï¼ŒåŒä¸€ä¸ªpartitionæ•°æ®åªèƒ½è¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ã€‚åŒä¸€ä¸ªgroupé‡Œçš„consumerå¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªtopicçš„ä¸åŒåˆ†åŒºçš„æ•°é‡ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ä¿è¯ï¼ŒåŒä¸€æ¶ˆæ¯ï¼Œä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ äºŒã€Kafkaæ ¸å¿ƒè§„åˆ™ å·¥ä½œæµç¨‹
producerå…ˆä»Žé›†ç¾¤ä¸­èŽ·å–åˆ†åŒºçš„leader producerå°†æ¶ˆæ¯å‘é€ç»™leader leaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶ followerä»Žleader pull æ¶ˆæ¯ followerå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶åŽï¼Œå‘leaderå‘é€ACK leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ACKåŽï¼Œå‘producerå‘é€ACK æ¯æ¡æ¶ˆæ¯æ˜¯è¿½åŠ åˆ°åˆ†åŒºä¸­ï¼Œé¡ºåºå†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥ä¿è¯åŒä¸€åˆ†åŒºçš„æ•°æ®æ˜¯æœ‰åºçš„ produceré‡‡ç”¨pushæ¨¡å¼å°†æ¶ˆæ¯å‘å¸ƒåˆ°broker followeræ˜¯ä¸»åŠ¨åŽ»leader pullæ¶ˆæ¯è¿›è¡ŒåŒæ­¥çš„ producerå¦‚ä½•ç¡®å®šæ•°æ®è¯¥å†™åˆ°é‚£ä¸ªpartition partitionåœ¨å†™å…¥çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦å†™å…¥çš„partitionï¼›å¦‚æžœæŒ‡å®šï¼Œåˆ™å†™å…¥å¯¹åº”çš„partition å¦‚æžœæ²¡æœ‰æŒ‡å®špartitionï¼Œä½†æ˜¯è®¾ç½®äº†keyï¼Œåˆ™ä¼šæ ¹æ®keyçš„å€¼hashåˆ°ä¸€ä¸ªpartition å¦‚æžœæ—¢æ²¡æœ‰partitionï¼Œä¹Ÿæ²¡æœ‰keyï¼Œåˆ™ä¼šè½®è¯¢é€‰å‡ºä¸€ä¸ªpartition å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼šproducerå†™å…¥æ¶ˆæ¯ã€followeråŒæ­¥leaderæ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›žACKï¼Œé€šè¿‡ACKåº”ç­”æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢ã€‚åœ¨ç”Ÿäº§è€…å‘kafkaå†™æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥è®¾å®šå‚æ•°acksæ¥ç¡®å®škafkaæ˜¯å¦ç¡®è®¤æ”¶åˆ°æ•°æ®ï¼Œè¿™ä¸ªå€¼å¯ä»¥è®¾ç½®ä¸º0ã€1ã€all
0ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusterä¸éœ€è¦ç­‰åˆ°clusterè¿”å›žACKæ¶ˆæ¯ï¼Œæ‰€ä»¥è®¾ç½®è¿™ä¸ªå€¼ä¸èƒ½ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå®‰å…¨æ€§æœ€ä½Žï¼Œä½†æ˜¯æ•ˆçŽ‡æœ€é«˜ 1ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œåªè¦leaderåº”ç­”å°±å¯ä»¥å‘é€ä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥è¿™ä¸ªè®¾ç½®åªèƒ½ç¡®ä¿å‘é€ç»™leaderæˆåŠŸ allä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œéœ€è¦æ‰€æœ‰çš„followeréƒ½å®Œæˆä»ŽleaderåŒæ­¥ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€æ¡ï¼Œç¡®ä¿leaderå‘é€æˆåŠŸå¹¶ä¸”æ‰€æœ‰followeréƒ½å®Œæˆå¤‡ä»½ã€‚å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯æ•ˆçŽ‡æœ€ä½Ž æ•°æ®ä¿å­˜
partitionç»“æž„ï¼šæ¯ä¸ªpartitionæ–‡ä»¶å¤¹ç”±å¤šä¸ªsegmentæ–‡ä»¶ç»„æˆï¼Œæ¯ç»„segmentæ–‡ä»¶åŒ…å«.indexã€.logæ–‡ã€.timeindexä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­.indexã€.logæ–‡ä»¶ä¸ºç´¢å¼•æ–‡ä»¶ï¼Œlogæ–‡ä»¶å°±æ˜¯å­˜å‚¨messageçš„åœ°æ–¹ã€‚Kafkaå°±æ˜¯åˆ©ç”¨segment+indexçš„æ–¹å¼è§£å†³æŸ¥è¯¢æ•ˆçŽ‡ä½Žé—®é¢˜ messageç»“æž„ï¼šmessageä¸»è¦åŒ…å«æ¶ˆæ¯ä½“ã€æ¶ˆæ¯å¤§å°ã€offsetã€åŽ‹ç¼©ç±»åž‹ç­‰ä¿¡æ¯ å­˜å‚¨ç­–ç•¥ï¼šæ— è®ºmessageæ˜¯å¦è¢«æ¶ˆè´¹ï¼ŒKafkaéƒ½ä¼šä¿å­˜æ‰€æœ‰æ¶ˆæ¯ï¼Œå¯¹äºŽæ—§æ•°æ®åˆ é™¤ç­–ç•¥æœ‰ä¸¤ç§ï¼šåŸºäºŽæ—¶é—´ï¼Œé»˜è®¤7å¤©ï¼›åŸºäºŽå¤§å°ï¼Œé»˜è®¤1GBã€‚ consumer groupä¸­consumerå’Œpartitionçš„å…³ç³»ï¼š
ä¸€ä¸ªconsumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionä¸­çš„æ•°æ® ä¸€ä¸ªpartitionåªèƒ½è¢«ä¸€ä¸ªconsumeræ¶ˆè´¹ ä¸‰ã€Kafkaåžåé‡å¤§çš„åŽŸå›  å››ã€QA leaderçš„é€‰ä¸¾
kafkaä¸æ˜¯å¤šæ•°æŠ•ç¥¨é€‰ä¸¾leaderã€‚kafkaåŠ¨æ€ç»´æŠ¤ä¸€ç»„åŒæ­¥leaderæ•°æ®çš„å‰¯æœ¬ï¼ˆISR in-sync-replicationï¼‰ï¼Œåªæœ‰è¿™ä¸ªç»„çš„æˆå‘˜æ‰æœ‰èµ„æ ¼å½“é€‰leaderï¼Œkafkaå‰¯æœ¬å†™å…¥ä¸è¢«è®¤ä¸ºæ˜¯å·²æäº¤ï¼Œç›´åˆ°æ‰€æœ‰çš„åŒæ­¥å‰¯æœ¬å·²ç»æŽ¥æ”¶æ‰è®¤ä¸ºã€‚è¿™ç»„ISRä¿å­˜åœ¨zookeeperï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ISRä¸­çš„ä»»ä½•å‰¯æœ¬éƒ½æœ‰èµ„æ ¼å½“é€‰leaderï¼Œè¿™æ˜¯kafkaçš„ä½¿ç”¨æ¨¡åž‹ï¼Œæœ‰å¤šä¸ªåˆ†åŒºå’Œç¡®ä¿leaderå¹³è¡¡æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æœ‰äº†è¿™ä¸ªæ¨¡åž‹ï¼ŒISRå’Œf+1å‰¯æœ¬ï¼Œkafkaçš„ä¸»é¢˜å¯ä»¥å®¹å¿få¤±è´¥è€Œä¸ä¼šä¸¢å¤±å·²æäº¤çš„æ¶ˆæ¯ã€‚
æˆä¸ºISRåˆ—è¡¨ä¸­çš„ä¸€å‘˜ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
å‰¯æœ¬èŠ‚ç‚¹å¿…é¡»èƒ½ä¸Žzookeeperä¿æŒä¼šè¯ï¼ˆå¿ƒè·³æœºåˆ¶ðŸ’—ï¼‰ å‰¯æœ¬èƒ½å¤Ÿå¤åˆ¶leaderä¸Šçš„æ‰€æœ‰å†™æ“ä½œï¼Œå¹¶ä¸”ä¸èƒ½è½åŽå¤ªå¤šï¼ˆå¡ä½æˆ–æ»žåŽçš„å‰¯æœ¬ç”±replica.lag.time.max.msé…ç½®ï¼‰ ä¸€æ—¦followerä»ŽleaderåŒæ­¥æ•°æ®çš„å»¶è¿Ÿè¶…è¿‡é˜€å€¼ï¼Œleaderå°±ä¼šæŠŠå®ƒä»ŽISRä¸­å‰”é™¤ï¼Œæ”¾å…¥OSRï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šåŠ å…¥OSR
AR(assigned replicas) = ISR+OSR (out of-sync-replicas)
å¦‚ä½•ä¿è¯å·²æäº¤çš„ä¿¡æ¯ä¸ä¸¢å¤±
replication+leaderé€‰ä¸¾æœºåˆ¶]]></description>
</item>
<item>
  <title>Cgroup_subsystem</title>
  <link>https://caijin.dev/zh/linux/cgroup_subsystem/</link>
  <pubDate>Thu, 22 Aug 2019 21:22:50 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/linux/cgroup_subsystem/</guid>
  <description><![CDATA[ä¸Šä¸€ç¯‡cgroupä¸»è¦è®²äº†cgroupå’Œå¸¸ç”¨çš„subsystemï¼Œç®—æ˜¯ç†è®ºéƒ¨åˆ†ï¼Œéƒ½è¯´å®žè·µå‡ºçœŸç†ï¼Œè¿™ç¯‡æ–‡ç« å°±æ˜¯å®žè·µéƒ¨åˆ†äº†ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ã€‚
subsystem cpuset
é™åˆ¶ cpuset.cpus: è®¾ç½®ä»»åŠ¡å¯ä»¥ä½¿ç”¨çš„CPUæ ¸å¿ƒçš„ç¼–å·ï¼Œæ ¼å¼ä¸ºï¼šfrom_number-to_number, numberï¼Œç”¨,éš”å¼€ cpuset.mems: è®¾ç½®cpuå¯ä½¿ç”¨çš„memory nodeï¼Œæ ¼å¼åŒä¸Š ç»Ÿè®¡ cpuset.effective_cpus: åœ¨ä½¿ç”¨çš„cpuæ ¸å¿ƒ cpuset.effective_mem: åœ¨ä½¿ç”¨çš„memory node cpuset.memory_pressureï¼šcupsetä¸­çš„åˆ†é¡µ cpu
é™åˆ¶ cpu.cfs_quota_us: è®¾å®šå‘¨æœŸå†…æœ€å¤šå¯ä½¿ç”¨çš„æ—¶é—´ cpu.cfs_period_us: è®¾ç½®ä½¿ç”¨cpuçš„å‘¨æœŸæ—¶é—´ï¼Œéœ€è¦å’Œcfs_quota_usé…åˆä½¿ç”¨ ç»Ÿè®¡ cpu.stat: æ˜¾ç¤ºå„ç§ç»Ÿè®¡ä¿¡æ¯ cpuacct.stat: ç»Ÿè®¡ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä½¿ç”¨çš„cpuæ—¶é•¿ cpuacct.usage_*: ç»Ÿè®¡æ¯ä¸ªä»»åŠ¡ä½¿ç”¨çš„cpuæ—¶é•¿ blkio
é™åˆ¶ blkio.throttle.read_bps_device: è®¾ç½®è¯»å–è®¾å¤‡çš„é€ŸçŽ‡ä¸Šé™ï¼Œæ ¼å¼ä¸ºï¼šdevice_num:node_number byte_per_second blkio.throttle.read_iops_device: è®¾ç½®æ¯ç§’è¯»å–è®¾å¤‡çš„æ¬¡æ•°ä¸Šé™ blkio.throttle.write_bps_device: è®¾ç½®å†™è®¾å¤‡çš„é€ŸçŽ‡ä¸Šé™ blkio.throttle.write_iops_device: è®¾ç½®æ¯ç§’å†™è®¾å¤‡çš„æ¬¡æ•° ç»Ÿè®¡ blkio.reset_stats: é‡ç½®ç»Ÿè®¡ä¿¡æ¯ blkio.throttle.io_service_bytes: è¯»è®¾å¤‡/å†™è®¾å¤‡çš„å­—èŠ‚æ•° blkio.throttle.*_recursive: å„ç§ç»Ÿè®¡æ•°æ®çš„é€’å½’ç‰ˆæœ¬ã€‚è¿™äº›æ–‡ä»¶æ˜¾ç¤ºä¸Žéžé€’å½’å¯¹åº”æ–‡ä»¶ç›¸åŒçš„ä¿¡æ¯ï¼Œä½†åŒ…æ‹¬æ¥è‡ªæ‰€æœ‰åŽä»£cgroupçš„ç»Ÿè®¡ä¿¡æ¯ blkio.throttle.io_serviced: ioæ¬¡æ•° memory
é™åˆ¶
memory.limit_in_bytes: è®¾ç½®å†…å­˜ä½¿ç”¨é™åˆ¶ï¼Œå•ä½æœ‰kã€mã€gï¼Œ-1æ—¶æ— é™åˆ¶
memory.max_usage_in_bytes: è®¾ç½®æœ€å¤§å†…å­˜ä½¿ç”¨é‡
memory.move_charge_at_immigrate: è®¾ç½®ç§»åŠ¨çš„èŠ±è´¹
memory.soft_limit_in_bytes: è½¯é™åˆ¶ï¼Œéœ€è¦æ¯”limit_in_byteså°
memory.oom_controlï¼šæ”¹å‚æ•°å¡« 0 æˆ– 1ï¼Œ 0è¡¨ç¤ºå¼€å¯ï¼Œå½“ cgroup ä¸­çš„è¿›ç¨‹ä½¿ç”¨èµ„æºè¶…è¿‡ç•Œé™æ—¶ç«‹å³æ€æ­»è¿›ç¨‹ï¼Œ1è¡¨ç¤ºä¸å¯ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å« memory å­ç³»ç»Ÿçš„ cgroup éƒ½å¯ç”¨]]></description>
</item>
<item>
  <title>Cgroup</title>
  <link>https://caijin.dev/zh/linux/cgroup/</link>
  <pubDate>Mon, 19 Aug 2019 20:18:42 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/linux/cgroup/</guid>
  <description><![CDATA[ç®€ä»‹ Croups(control groups)æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§å¯ä»¥é™åˆ¶ã€è®°å½•ã€éš”ç¦»è¿›ç¨‹(è¿›ç¨‹ç»„)æ‰€ä½¿ç”¨çš„çš„ç‰©ç†èµ„æºï¼ˆå¦‚ï¼šCPUã€memoryã€IOã€deviceç­‰ï¼‰çš„æœºåˆ¶ã€‚æ˜¯è½»é‡çº§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆdockerã€lxcï¼‰çš„åŸºç¡€ä¹‹ä¸€ã€‚å¦å¤–çš„åŸºç¡€åŒ…æ‹¬namespaceã€ufs(union file system)ç­‰ã€‚
æ¦‚å¿µ åŸºæœ¬æ¦‚å¿µ ä»»åŠ¡ï¼ˆtaskï¼‰ã€‚åœ¨cgroupä¸­ï¼Œä»»åŠ¡å°±æ˜¯ç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ã€‚ æŽ§åˆ¶ç»„ï¼ˆcontrol groupï¼‰ã€‚æŽ§åˆ¶ç»„å°±æ˜¯ä¸€ç»„æŒ‰ç…§æŸç§æ ‡å‡†åˆ’åˆ†çš„è¿›ç¨‹ï¼Œæ¯”å¦‚æŒ‰å†…å­˜å¤§å°ï¼Œcpuçš„ä½¿ç”¨çŽ‡ï¼Œæˆ–è€…ioçš„é€ŸçŽ‡é™åˆ¶åˆ’åˆ†æˆç»„ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŠ å…¥åˆ°æŸä¸ªæŽ§åˆ¶ç»„ï¼Œä¹Ÿå¯ä»¥ä»Žä¸€ä¸ªç»„è¿ç§»åˆ°å¦å¤–ä¸€ä¸ªç»„ã€‚ä¸€ä¸ªç»„ä¸­çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨cgroupä»¥æŽ§åˆ¶ç»„ä¸ºå•ä½åˆ†é…çš„èµ„æºï¼ŒåŒæ—¶å—åˆ°ç»„åˆ†é…åˆ°çš„èµ„æºçš„é™åˆ¶ã€‚ å±‚çº§ï¼ˆhierarchyï¼‰ã€‚æŽ§åˆ¶ç»„å¯ä»¥ç»„ç»‡æˆä¸ºå±‚çº§çš„å½¢å¼ï¼Œç»„æˆä¸€æ£µæŽ§åˆ¶ç»„æ ‘ã€‚æŽ§åˆ¶ç»„æ ‘ä¸Šçš„å­èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹æŽ§åˆ¶ç»„çš„å­©å­ï¼Œç»§æ‰¿çˆ¶æŽ§åˆ¶ç»„çš„èµ„æºé™åˆ¶ã€‚ å­ç³»ç»Ÿï¼ˆsubsystemï¼‰ã€‚ä¸€ä¸ªå­ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªèµ„æºæŽ§åˆ¶å™¨ï¼Œå­ç³»ç»Ÿå¿…é¡»é™„åŠ ï¼ˆattachï¼‰åˆ°ä¸€ä¸ªå±‚çº§ä¸Šæ‰èƒ½ä½¿ç”¨ã€‚ å…³ç³»å’Œé™åˆ¶ ä¸€ä¸ªå­ç³»ç»Ÿæœ€å¤šåªèƒ½é™„åŠ åˆ°ä¸€ä¸ªå±‚çº§ã€‚ ä¸€ä¸ªå±‚çº§å¯ä»¥æœ‰å¤šä¸ªå­ç³»ç»Ÿã€‚ ä¸€ä¸ªä»»åŠ¡å¯ä»¥æ˜¯å¤šä¸ªcgroupçš„æˆå‘˜ï¼Œä½†æ˜¯è¿™äº›cgroupå¿…é¡»æ˜¯ä¸åŒçš„å±‚çº§ã€‚ ä»»åŠ¡åˆ›å»ºå­ä»»åŠ¡æ—¶ï¼Œå­ä»»åŠ¡è‡ªåŠ¨æˆä¸ºå…¶çˆ¶ä»»åŠ¡æ‰€åœ¨çš„cgroupæˆå‘˜ã€‚å¯ä»¥æŠŠå­ä»»åŠ¡ç§»åŠ¨åˆ°ä¸åŒçš„cgroupä¸­ï¼Œä½†æœ€å¼€å§‹æ—¶ï¼Œå®ƒæ€»æ˜¯ç»§æ‰¿çˆ¶ä»»åŠ¡çš„cgroupã€‚ ç³»ç»Ÿæ”¯æŒçš„å­ç³»ç»Ÿ æŸ¥çœ‹ç³»ç»Ÿæ”¯æŒçš„cgroup
# 1ã€å®‰è£…cgroupå·¥å…·ï¼Œå¦‚æžœå·²ç»å®‰è£…ï¼Œè¯·å¿½ç•¥ sudo apt install cgroup-tools # 2ã€æŸ¥çœ‹ç³»ç»Ÿçš„å­ç³»ç»Ÿ $lssubsys cpuset cpu,cpuacct blkio memory devices freezer net_cls,net_prio perf_event hugetlb pids rdma jin@k53:~$ jin@k53:~$ uname -a Linux k53 5.0.0-25-generic #26-Ubuntu SMP Thu Aug 1 12:04:58 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux jin@k53:~$ lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 19.]]></description>
</item>
<item>
  <title>Namespace_Improve</title>
  <link>https://caijin.dev/zh/linux/namespace_improve/</link>
  <pubDate>Fri, 16 Aug 2019 21:03:23 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/linux/namespace_improve/</guid>
  <description><![CDATA[åœ¨ä¸Šä¸€ç¯‡namespaceçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£å¹¶é€šè¿‡ç¨‹åºå†™äº†ä¸€ä¸ªç®€å•ç‰ˆçš„å®¹å™¨ï¼Œä½“éªŒäº†Linux namespaceçš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿˜æœ‰ä¸¤ä¸ªç¾Žä¸­ä¸è¶³çš„åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯éœ€è¦ä½¿ç”¨rootæƒé™æ‰èƒ½å¤Ÿè¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼Œå¦å¤–ä¸€ä¸ªæˆ‘ä»¬åœ¨å®¹å™¨ä¸­ä½¿ç”¨psçœ‹åˆ°pidä¸º1çš„è¿›ç¨‹æ˜¯/proc/self/exe child shï¼Œè€Œä¸æ˜¯shã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±è®²è®²å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚
rootæƒé™ åœ¨Linux namespaceä¸­ï¼Œåªæœ‰user namespace æ˜¯å¯ä»¥è¢«æ™®é€šç”¨æˆ·åˆ›å»ºçš„ï¼Œå…¶ä»–çš„namespace éƒ½éœ€è¦æœ‰rootæƒé™æ‰å¯ä»¥ã€‚ä½†è¿™æ ·å°±ä¼šæœ‰é—®é¢˜ï¼š
1ã€å¹¶ä¸æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰sudoæƒé™ï¼›
2ã€è¿›ç¨‹çš„å®‰å…¨æ€§ã€‚
å…¶å®žç¬¬ä¸€ç‚¹è¿˜å¥½è§£å†³ï¼Œå…³é”®æ˜¯ç¬¬äºŒç‚¹ï¼Œè¿è¡Œçš„è¿›ç¨‹æ˜¯ä»¥rootæƒé™è¿è¡Œçš„ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹å—åˆ°æ”»å‡»ï¼ŒæŽ§åˆ¶æƒåˆ°äº†æ”»å‡»è€…çš„æ‰‹ä¸­ï¼Œæ­¤æ—¶çš„è¿›ç¨‹æ˜¯ç”¨rootæƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥ç”¨è¯¥è¿›ç¨‹æ‰§è¡Œä»»æ„æƒé™çš„æ“ä½œã€‚
ä¹Ÿæœ‰äººå¯èƒ½ä¼šæƒ³ï¼Œæˆ‘ä»¬ä¸æ˜¯å·²ç»æŠŠæ‰€æœ‰çš„namespaceéƒ½cloneå‡ºæ¥äº†ä¹ˆï¼Œrootfsä¹Ÿæ”¹å˜äº†ï¼Œå³ä½¿è¢«æ”»å‡»äº†ï¼Œå½±å“çš„èŒƒå›´ä¹Ÿå°±æ˜¯containerä¸­ã€‚è¯´çš„æ˜¯æ²¡é”™ï¼Œä¸è¿‡ï¼Œå¦‚æžœæˆ‘ä»¬æŠŠä¸»æœºçš„ç›®å½•å½“ä½œå·æŒ‚è½½åˆ°äº†containerä¸­ï¼Œé‚£ä¹ˆæ”»å‡»è€…æ‰€èƒ½å½±å“çš„èŒƒå›´å°±æ‰©å¤§åˆ°äº†ä¸»æœºä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªå½±å“å‡å°‘åˆ°æœ€å°‘&mdash;å½“å‰ç”¨æˆ·çš„æƒé™ã€‚çœ‹çœ‹ä»£ç ï¼š
uid := os.Getuid() gid := os.Getgid() cmd.SysProcAttr = &amp;syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUSER | syscall.CLONE_NEWUTS | syscall.CLONE_NEWNS | syscall.CLONE_NEWIPC | syscall.CLONE_NEWNET | syscall.CLONE_NEWPID, UidMappings: []syscall.SysProcIDMap{{0, uid, 1}}, GidMappings: []syscall.SysProcIDMap{{0, gid, 1}}, Credential: &amp;syscall.Credential{ Uid: 0, Gid: 0, }, }ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œå¾—åˆ°å½“å‰ç™»é™†ç”¨æˆ·çš„uid/gid (user id/ group id)ï¼›
ç¬¬å…­è¡Œï¼Œæˆ‘ä»¬åšäº†ä¸€ä¸ªuidçš„æ˜ å°„ï¼Œsyscall.SysProcIDMapç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®¹å™¨å†…çš„ç”¨æˆ·çš„idï¼Œ0æ˜¯rootï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦æ˜ å°„çš„ç”¨æˆ·çš„æƒé™ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ˜ å°„èŒƒå›´ï¼Œä¸€èˆ¬ç”¨1å°±å¯ä»¥ï¼Œè¡¨ç¤ºä¸€ä¸€å¯¹åº”ï¼›ç¬¬ä¸ƒè¡Œä¹Ÿæ˜¯ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯gidçš„æ˜ å°„ï¼›
ç¬¬8è¡Œï¼Œè®¾ç½®å®¹å™¨å†…ç”¨æˆ·çš„uidå’Œgidï¼Œéƒ½ä¸º0ï¼Œè¯´æ˜Žæ˜¯ç”¨æˆ·æ˜¯rootï¼Œç”¨æˆ·æ‰€åœ¨çš„ç»„æ˜¯rootç»„
é‡æ–°ç¼–è¯‘è¿è¡Œï¼š
jin@k53:~/go-test$ go build namespace.go jin@k53:~/go-test$ ./namespace run sh p pid: 4342 c p pid: 0 c pid: 1 / # / # å¯ä»¥çœ‹åˆ°çŽ°åœ¨ä¸ç”¨rootæƒé™å°±å¯ä»¥è¿è¡Œäº†ã€‚docker ä¹Ÿä¸éœ€è¦rootæƒé™å°±èƒ½è¿è¡Œå‘¢ï¼Œå‘dockeråˆå‰è¿›äº†ä¸€å°æ­¥ï¼Œè€Œä¸”ï¼Œå®¹å™¨å†…æ˜¯rootï¼Œå®¹å™¨å¤–ï¼Œshå…¶å®žæ˜¯ä»¥æ™®é€šç”¨æˆ·æ‰§è¡Œçš„ï¼Œå®‰å…¨æ€§åˆå¾—åˆ°äº†ä¿è¯ã€‚å…¶å®žè¿™ç§å®‰å…¨æ€§æ˜¯å¾ˆç²—ç³™çš„ï¼Œå…³äºŽå®¹å™¨çš„å®‰å…¨æ€§ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„è¯é¢˜ï¼ŒåŽé¢ä¹Ÿè®¸ä¼šå•ç‹¬è°ˆè°ˆã€‚]]></description>
</item>
<item>
  <title>Namespace</title>
  <link>https://caijin.dev/zh/linux/namespace/</link>
  <pubDate>Wed, 14 Aug 2019 19:33:19 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/linux/namespace/</guid>
  <description><![CDATA[ç®€ä»‹ linux namespace æ˜¯linuxå†…æ ¸æä¾›çš„ä¸€ç§çŽ¯å¢ƒï¼ˆèµ„æºï¼‰éš”ç¦»çš„æ–¹å¼ï¼Œä¸»è¦æä¾›äº†UTSã€IPCã€networkã€Userã€mountã€PIDçš„éš”ç¦»
ç±»åˆ« ç³»ç»Ÿè°ƒç”¨å‚æ•° å†…æ ¸ç‰ˆæœ¬ ä½œç”¨ UTS CLONE_NEWUTS Linux 2.6.19 éš”ç¦»ä¸»æœºåç§°ï¼ŒåŸŸåç§° IPC CLONE_NEWIPC Linux 2.6.10 éš”ç¦»è¿›ç¨‹é—´é€šä¿¡ Network CLONE_NEWNET Linux 2.6.29 éš”ç¦»ç½‘ç»œ User CLONE_NEWUSER Linux 3.8 éš”ç¦»ç”¨æˆ· Mount CLONE_NEWNS Linux 2.4.19 éš”ç¦»æŒ‚è½½ç‚¹ PID CLONE_NEWPID linux 2.6.24 éš”ç¦»è¿›ç¨‹ID UTC æœªéš”ç¦»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¸»æœºåï¼Œæ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼Œç»ˆç«¯1æ‰§è¡Œhostnameï¼ŒæŸ¥çœ‹å½“å‰ä¸»æœºåï¼Œç¬¬äºŒä¸ªç»ˆç«¯ä¸­æ‰§è¡Œsudo hostname xxxå†åœ¨ç»ˆç«¯1ä¸­æ‰§è¡Œhostnameï¼Œå¯ä»¥å‘çŽ°ä¸»æœºåç§°å·²ç»è¢«ä¿®æ”¹äº†ã€‚
ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„æ„Ÿå—ä¸‹namespaceï¼Œè‡ªå·±åŠ¨æ‰‹å†™ä¸ªç¨‹åºæ˜¯æœ€å¥½ä¸è¿‡çš„æ–¹å¼äº†ï¼Œä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ªdemoï¼Œæ–‡ä»¶åæ˜¯namespace.go
package main import ( &#34;fmt&#34; &#34;os&#34; &#34;os/exec&#34; &#34;syscall&#34; ) func main() { cmd := exec.Command(os.Args[1]) cmd.SysProcAttr = &amp;syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS, } cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.]]></description>
</item>
<item>
  <title>Arch_install</title>
  <link>https://caijin.dev/zh/linux/arch_install/</link>
  <pubDate>Sat, 13 Jul 2019 22:24:48 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/linux/arch_install/</guid>
  <description><![CDATA[ä½¿ç”¨*nux åˆ¶ä½œUç›˜å¯åŠ¨ç›˜ fdisk -l #æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­çš„ç£ç›˜è®¾å¤‡ï¼Œè¿™é‡Œuç›˜è®¾å¤‡æ˜¯/dev/disk2 umount /dev/disk2 #å¸è½½æŒ‚è½½ç‚¹ï¼Œå¤‡ä»½uç›˜é‡Œé¢çš„é‡è¦æ–‡ä»¶ï¼Œåˆ¶ä½œå¯åŠ¨ç›˜ä¼šæ‰§è¡Œæ ¼å¼åŒ– sudo dd if=archlinux-2019.07.01-x86_64.iso of=/dev/disk2 bs=1m #è¿™ç”¨æ—¶å¯èƒ½ä¼šæ¯”è¾ƒä¹…ï¼Œç¨ç­‰ä¸€ä¸‹å‡†å¤‡ åˆ¶ä½œå¥½uç›˜å¯åŠ¨ç›˜ä¹‹åŽï¼Œè®¾ç½®ç”µè„‘ä»Žuç›˜å¯åŠ¨ï¼Œä¹‹åŽè¿›å…¥åˆ°arch liveé‡Œé»˜è®¤ä»¥rootç”¨æˆ·ç™»å½•ï¼Œä¹‹åŽå°±å¯ä»¥è¿›è¡Œå‡†å¤‡æ“ä½œäº†ã€‚
vim /etc/hostname #ä¿®æ”¹å®‰è£…åŽçš„ä¸»æœºå fdisk /dev/sda #åˆ†åŒºï¼Œæ³¨æ„è®¾å¤‡ï¼Œæˆ‘è¿™é‡Œæ˜¯sda mkfs.ext4 /dev/sda1 #æ ¼å¼åŒ–åˆ†åŒº mount /dev/sda1 /mnt #æŒ‚è½½åˆ†åŒº vim /etc/pacman.d/mirrorlist #å°†ä¸­å›½åŒºçš„æºæ”¾åˆ°éžæ³¨é‡Šçš„ç¬¬ä¸€è¡Œï¼Œä¼šæé«˜è½¯ä»¶åŒ…çš„ä¸‹è½½é€Ÿåº¦ï¼Œè¶Šé å‰ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ pacman -Syy #æ›´æ–°é•œåƒæº dhcpcd #ä½¿ç”¨dhcpè‡ªåŠ¨èŽ·å–ipåœ°å€ ip addr show #åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°åˆ†é…åˆ°ipåœ°å€äº†ï¼Œå¦‚æžœä½¿ç”¨çš„wifiï¼Œå¹¶ä¸”åŠ å¯†æ–¹å¼æ˜¯wpaï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿žæŽ¥wifi wpa_supplicant -i wpl3s0 -c &lt;(wpa_passphrase wifi-ssid password) #wpl3s0 wifi-ssid password åˆ†åˆ«æ˜¯æ— çº¿ç½‘å¡åç§°ï¼Œwifiåç§°ï¼Œwifiå¯†ç å®‰è£… pacstrap /mnt base base-devel #å¼€å§‹å®‰è£…åˆ°mntï¼Œä¸€è·¯å›žè½¦å°±å¥½ï¼Œç¨ç­‰ç›´åˆ°å®Œæˆã€‚ arch-chroot /mnt #æ”¹å˜rootç›®å½• vim /etc/locale.gen #åˆ é™¤en_US.UTF-8 å’Œ zh_CN.UTF-8 å‰é¢çš„æ³¨é‡Š locale-gen #ç”Ÿæˆè¯­è¨€åŒºåŸŸçš„ä¸€äº›æ–‡ä»¶ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime #è®¾ç½®æ—¶åŒºä¸ºäºšæ´²ä¸Šæµ·çš„æ—¶åŒº(+08:00)å®‰è£…å¼•å¯¼ç¨‹åºGRUB pacmanm -S os-prober grub #å®‰è£…grubåŠä¾èµ– grub-install --target=i386-pc /dev/sda #BIOSæ–¹å¼ grub-install /dev/sda #EFIæ–¹å¼ grub-mkconfig -o /boot/grub/grub.]]></description>
</item>
</channel>
</rss>
