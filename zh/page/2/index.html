<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
	<meta name="generator" content="Hugo 0.129.0">
    
      <meta name="theme" content='FixIt v0.3.9'>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>*&lt;^_^&gt;*</title><meta name="author" content="caijin">
<meta name="author-link" content="https://caijin.dev">
<meta name="description" content="" />
  <meta itemprop="name" content="*&lt;^_^&gt;*">
  <meta itemprop="datePublished" content="2020-05-02T20:20:42+08:00">
  <meta itemprop="dateModified" content="2020-05-02T20:20:42+08:00"><meta property="og:url" content="https://caijin.dev/zh/">
  <meta property="og:site_name" content="*&lt;^_^&gt;*">
  <meta property="og:title" content="*&lt;^_^&gt;*">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="*&lt;^_^&gt;*">
<meta name="application-name" content="FixIt">
<meta name="apple-mobile-web-app-title" content="FixIt"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://caijin.dev/zh/" /><link rel="alternate" href="/zh/index.xml" type="application/rss+xml" title="*&lt;^_^&gt;*">
  <link rel="feed" href="/zh/index.xml" type="application/rss+xml" title="*&lt;^_^&gt;*"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebSite",
    "url": "https:\/\/caijin.dev\/zh\/","inLanguage": "zh-CN","author": {
        "@type": "Person",
        "name": "caijin"
      },"license": "xxxx","name": "*\u003c^_^\u003e*"
  }
  </script></head>
  <body data-header-desktop="sticky" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper" data-page-style="normal"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper">
    <div class="header-title">
      <a href="/zh/" title="*&lt;^_^&gt;*"><span class="header-title-text">*&lt;^_^&gt;*</span></a><span class="header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item active">
              <a
                class="menu-link"
                href="/zh/"
                
                
              >文档</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/zh/categories/"
                
                
              >分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/zh/tags/"
                
                
              >标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="https://github.com/CaiJinKen"
                
                rel="noopener noreferrer" target="_blank"
              ><i class="fa fa-heart" style="color:red"></i> github</a></li><li class="menu-item delimiter"></li><li class="menu-item theme-switch" title="">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language-switch">
            <span role="button" aria-label="" title=""><i class="fa-solid fa-language fa-fw" aria-hidden="true"></i></span>
            <ul class="sub-menu"><li class="menu-item">
                      <span class="menu-link text-secondary" title="简体中文">简体中文</span>
                    </li><li class="menu-item">
                      <a href="/en/" class="menu-link" title="English">English</a>
                    </li></ul>
          </li></ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="/zh/" title="*&lt;^_^&gt;*"><span class="header-title-text">*&lt;^_^&gt;*</span></a><span class="header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li
              class="menu-item active"
            ><a
                  class="menu-link"
                  href="/zh/"
                  
                  
                >文档</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/zh/categories/"
                  
                  
                >分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/zh/tags/"
                  
                  
                >标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="https://github.com/CaiJinKen"
                  
                  rel="noopener noreferrer" target="_blank"
                ><i class="fa fa-heart" style="color:red"></i> github</a></li><li class="menu-item menu-system">
          <span class="menu-system-item theme-switch" title=""><i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i></span><span class="menu-system-item language-switch">
              <span role="button" aria-label="" title="">简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i></span>
              <select class="language-select" onchange="location = this.value;"><option value="/zh/" selected disabled>简体中文</option><option value="/en/">English</option></select>
            </span></li>
      </ul>
    </nav>
  </div>
</header><main class="container"><div class="page home posts"><article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/mysql/mysql/">Mysql简介</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-05-02 20:18:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">Mysql MyISAM vs Innodb?
mysql的索引有哪些
聚簇索引
在innodb表上定义了一个主键，innodb默认会使用它作为组簇索引（建议每个表都定义个主键） 如果没有定义主键，innodb会查找第一个【唯一索引】作为聚簇索引 如果既没有定义主键，又没有唯一索引，innodb会在内部生成一个名为_GEN_CLUST_INDEX_ 的隐式聚簇索引 聚簇索引如何加快查询速度：因为索引搜索直接指向包含所有行数据页（data page）
非聚簇索引
非聚簇索引通常也被称为二级索引或辅助索引，在innodb中，每个辅助索引中的每条记录都会包含该行的主键列 ( 也就是聚簇索引的键 ) ，以及为辅助索引指定的列。InnoDB 使用此主键值来搜索聚簇索引中的行
以上两者的区别
划分依据
InnoDB 会使用聚簇索引来保存数据，而非聚簇索引的目的仅仅是加快查询速度
主要区别
聚簇索引是唯一的，一个 InnoDB 表只有一个聚簇索引，而且一定会有一个聚簇索引，如果不存在，Innodb 存储引擎会自动添加一个 非聚簇所以可以有多个，而且只能由用户自己添加，InnoDB 默认并不会创建任何非聚簇索引 包含关系
非聚簇索引中一定包含了聚簇索引的列值，但反过来却不存在
什么是组合索引，匹配原则是什么
什么是多表连接？有哪些连接类型，原理是什么？
事物的隔离级别以及特征
级别 说明 Read uncommitted 当一个事物A更改了数据，但还未提交的时候，另外一个事物B读取这个数据的时候，读取的是A未提交的数据。如果A回滚了事物，就发生了脏读 Read committed 事物A读取了数据，事物B紧接着更新并提交了数据，当事物A再次读取该数据时，数据已经发生了改变，同一个事物，多次读取的数据不一致，就是所谓不可重复读 Repeatable read 当一个事物开始的时候，其他的事物就不能对数据进行更改，这样，数据就是可重复读的了。但是这样还是不能避免幻读：事物A开启了以后一直读取的是备份数据，事物B在这个时候删除了数据并提交了，但是A事物查询到的还是旧数据，这样就产生幻读了 Serializable 这是最高的事物隔离级别，事物只能一个个顺序执行，所以性能很低 Innodb是如何实现行锁的？
mysql锁类型
全局锁：对整个数据库实例加锁，主要用于全库备份 表级锁：表锁和元数据锁MDL，表锁：如果不能确定唯一性的话，会对整个表进行加锁；如果没有更改表结构，MDL加读锁，否则加写锁，读锁和写锁是互斥的 行锁：针对特定的数据加锁，mysql对索引加锁，oracle是对数据加锁，innodb行锁的算法： Record locks：为索引纪录上锁，如果没有定义索引，Innodb会为该表创建一个隐藏的聚簇索引，并使用该索引 Gap locks：该锁会锁定一个范围，但是不包括纪录本身。 Next-key locks：就是record locks和gap locks的组合，即锁定一个范围和该纪录本身。Innodb使用该锁解决幻读问题。如果索引具有唯一性，则innodb会将next-key locks自动降为record locks mysql组合索引按照最左匹配的原则进行匹配
比如有个key（a,b,c)，则支持a|a,b|a,b,c 3种组合进行查找，但不支持b，c查找，而且与where条件的顺序无关，因为优化器会对sql进行优化
索引失效的条件：
在索引上做任何操作（计算，函数，自动或者手动类型转换），会导致索引失效而转向全表扫描 存储索引不能使用索引_范围条件_ 右边的列 使用不等于（！= ｜｜ &lt;&gt;）的时候无法使用索引，会导致全表扫描 like以通配符开头，索引失败，全表扫描 一般建议：</div><div class="post-footer">
    <a href="/zh/mysql/mysql/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/mysql/' class="post-tag">Mysql</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/front-end/axios%E7%9A%84%E4%BD%BF%E7%94%A8/">Axios的使用</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2020-04-18 21:24:19'></span><span class="post-included-in">&nbsp;</span></div><div class="content">axios 的使用 axios 是前端最常见的网络库。主要调用方式有两种形式：axios(config) 和 axios(url, config)，下面简要介绍axios的使用。
1、请求方法 常用的http请求方法有以下5个
方法 作用 GET 请求资源 POST 新增资源 PUT 更新资源（需要资源的所有信息） PATCH 更新资源的部分信息 DELETE 删除资源 例如有user对象：{&quot;id&quot;:1, &quot;name&quot;:&quot;axios-user&quot;, &quot;age&quot;:20}
使用axios发起请求可以用axios(config)的形式，如下所示：
axios({ method:&#34;get&#34;,//请求方法 url:&#34;/users&#34;,//请求的URL params:{id:1},//get、delete方法的请求参数，会放到url之后 data:{}//post、put、patch方法的请求参数，会放到body中 }).then((resp)=&gt;{ //请求成功的处理 console.log(resp.data)//控制台打印返回的body数据 }).catch((err)=&gt;{ //请求失败的处理 console.log(err) }).then(()={ //不管成功与否，都会执行 console.log(&#34;此处一定会执行&#34;) })对于其他的方式，换一下config对象种的method即可
2、别名 如果有很多的请求，每个我们都需要写一堆像上面1中的axios的配置信息，一个是写起来比较麻烦，另外一个，代码看起来也比较乱，axios也提供了对应请求方法的别名函数，用axios(url, config)的形式，如下所示：
//get axios(&#34;/users&#34;,{params:{id:1}}).then((resp)=&gt;{}) //等同于如下方式 axios.get(&#34;/users&#34;,{params:{id:1}}).then((resp)=&gt;{}) //post axios.post(&#34;/user&#34;,{id:2,name:&#34;axios-user2&#34;,age:22}) //put 只更新部分信息也需要将整个资源对象提交 axios.put(&#34;/user&#34;,{id:2,name:&#34;axios-xxx&#34;,age:22}) //patch 只需提交唯一标识和更改的数据项即可 axios.patch(&#34;/users&#34;,{id:2,age:18}) //delete axios.delete(&#34;/users&#34;,{params:{id:2}})3、并发请求 axios 也支持同时发起多个请求，并且可以获取到每个请求的结果，使用axios.all() 和 axios.spread()即可，all()方法的参数是函数数组，spread()方法接受的是回调函数，函数中的参数即是all()中的请求结果，顺序和all()保持一致。
例子如下：
axios.all( [ axios.get(&#34;/users&#34;),//请求1 axios.get(&#34;/students&#34;),//请求2 axios.post(&#34;/teachers&#34;,{id:5,name:&#34;teacher wang&#34;,age:35})//请求3 ] ).then( axios.</div><div class="post-footer">
    <a href="/zh/front-end/axios%E7%9A%84%E4%BD%BF%E7%94%A8/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/javascript/' class="post-tag">JavaScript</a><a href='/zh/tags/axis/' class="post-tag">Axis</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/linux/cgroup_subsystem/">Cgroup_subsystem</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2019-08-22 21:22:50'></span><span class="post-included-in">&nbsp;</span></div><div class="content">上一篇cgroup主要讲了cgroup和常用的subsystem，算是理论部分，都说实践出真理，这篇文章就是实践部分了，介绍如何使用。
subsystem cpuset
限制 cpuset.cpus: 设置任务可以使用的CPU核心的编号，格式为：from_number-to_number, number，用,隔开 cpuset.mems: 设置cpu可使用的memory node，格式同上 统计 cpuset.effective_cpus: 在使用的cpu核心 cpuset.effective_mem: 在使用的memory node cpuset.memory_pressure：cupset中的分页 cpu
限制 cpu.cfs_quota_us: 设定周期内最多可使用的时间 cpu.cfs_period_us: 设置使用cpu的周期时间，需要和cfs_quota_us配合使用 统计 cpu.stat: 显示各种统计信息 cpuacct.stat: 统计用户态和内核态使用的cpu时长 cpuacct.usage_*: 统计每个任务使用的cpu时长 blkio
限制 blkio.throttle.read_bps_device: 设置读取设备的速率上限，格式为：device_num:node_number byte_per_second blkio.throttle.read_iops_device: 设置每秒读取设备的次数上限 blkio.throttle.write_bps_device: 设置写设备的速率上限 blkio.throttle.write_iops_device: 设置每秒写设备的次数 统计 blkio.reset_stats: 重置统计信息 blkio.throttle.io_service_bytes: 读设备/写设备的字节数 blkio.throttle.*_recursive: 各种统计数据的递归版本。这些文件显示与非递归对应文件相同的信息，但包括来自所有后代cgroup的统计信息 blkio.throttle.io_serviced: io次数 memory
限制
memory.limit_in_bytes: 设置内存使用限制，单位有k、m、g，-1时无限制
memory.max_usage_in_bytes: 设置最大内存使用量
memory.move_charge_at_immigrate: 设置移动的花费
memory.soft_limit_in_bytes: 软限制，需要比limit_in_bytes小
memory.oom_control：改参数填 0 或 1， 0表示开启，当 cgroup 中的进程使用资源超过界限时立即杀死进程，1表示不启用。默认情况下，包含 memory 子系统的 cgroup 都启用</div><div class="post-footer">
    <a href="/zh/linux/cgroup_subsystem/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/docker/' class="post-tag">Docker</a><a href='/zh/tags/linux/' class="post-tag">Linux</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/linux/cgroup/">Cgroup</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2019-08-19 20:18:42'></span><span class="post-included-in">&nbsp;</span></div><div class="content">简介 Croups(control groups)是Linux内核提供的一种可以限制、记录、隔离进程(进程组)所使用的的物理资源（如：CPU、memory、IO、device等）的机制。是轻量级虚拟化技术（docker、lxc）的基础之一。另外的基础包括namespace、ufs(union file system)等。
概念 基本概念 任务（task）。在cgroup中，任务就是系统的一个进程。 控制组（control group）。控制组就是一组按照某种标准划分的进程，比如按内存大小，cpu的使用率，或者io的速率限制划分成组。一个进程可以加入到某个控制组，也可以从一个组迁移到另外一个组。一个组中的进程可以使用cgroup以控制组为单位分配的资源，同时受到组分配到的资源的限制。 层级（hierarchy）。控制组可以组织成为层级的形式，组成一棵控制组树。控制组树上的子节点是父节点控制组的孩子，继承父控制组的资源限制。 子系统（subsystem）。一个子系统就是一个资源控制器，子系统必须附加（attach）到一个层级上才能使用。 关系和限制 一个子系统最多只能附加到一个层级。 一个层级可以有多个子系统。 一个任务可以是多个cgroup的成员，但是这些cgroup必须是不同的层级。 任务创建子任务时，子任务自动成为其父任务所在的cgroup成员。可以把子任务移动到不同的cgroup中，但最开始时，它总是继承父任务的cgroup。 系统支持的子系统 查看系统支持的cgroup
# 1、安装cgroup工具，如果已经安装，请忽略 sudo apt install cgroup-tools # 2、查看系统的子系统 $lssubsys cpuset cpu,cpuacct blkio memory devices freezer net_cls,net_prio perf_event hugetlb pids rdma jin@k53:~$ jin@k53:~$ uname -a Linux k53 5.0.0-25-generic #26-Ubuntu SMP Thu Aug 1 12:04:58 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux jin@k53:~$ lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 19.</div><div class="post-footer">
    <a href="/zh/linux/cgroup/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/linux/' class="post-tag">Linux</a><a href='/zh/tags/docker/' class="post-tag">Docker</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/linux/namespace_improve/">Namespace_Improve</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2019-08-16 21:03:23'></span><span class="post-included-in">&nbsp;</span></div><div class="content">在上一篇namespace的文章中，我们了解并通过程序写了一个简单版的容器，体验了Linux namespace的功能，但是还有两个美中不足的地方，一个是需要使用root权限才能够运行我们的程序，另外一个我们在容器中使用ps看到pid为1的进程是/proc/self/exe child sh，而不是sh。所以这篇文章就讲讲如何解决这两个问题。
root权限 在Linux namespace中，只有user namespace 是可以被普通用户创建的，其他的namespace 都需要有root权限才可以。但这样就会有问题：
1、并不是每个用户都有sudo权限；
2、进程的安全性。
其实第一点还好解决，关键是第二点，运行的进程是以root权限运行的，这就有可能导致安全问题，比如，容器内的进程受到攻击，控制权到了攻击者的手中，此时的进程是用root权限运行的，所以攻击者可以用该进程执行任意权限的操作。
也有人可能会想，我们不是已经把所有的namespace都clone出来了么，rootfs也改变了，即使被攻击了，影响的范围也就是container中。说的是没错，不过，如果我们把主机的目录当作卷挂载到了container中，那么攻击者所能影响的范围就扩大到了主机中。所以，我们就把这个影响减少到最少&mdash;当前用户的权限。看看代码：
uid := os.Getuid() gid := os.Getgid() cmd.SysProcAttr = &amp;syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUSER | syscall.CLONE_NEWUTS | syscall.CLONE_NEWNS | syscall.CLONE_NEWIPC | syscall.CLONE_NEWNET | syscall.CLONE_NEWPID, UidMappings: []syscall.SysProcIDMap{{0, uid, 1}}, GidMappings: []syscall.SysProcIDMap{{0, gid, 1}}, Credential: &amp;syscall.Credential{ Uid: 0, Gid: 0, }, }第一行和第二行得到当前登陆用户的uid/gid (user id/ group id)；
第六行，我们做了一个uid的映射，syscall.SysProcIDMap第一个参数是容器内的用户的id，0是root，第二个参数是需要映射的用户的权限，第三个参数是映射范围，一般用1就可以，表示一一对应；第七行也是一样，只不过是gid的映射；
第8行，设置容器内用户的uid和gid，都为0，说明是用户是root，用户所在的组是root组
重新编译运行：
jin@k53:~/go-test$ go build namespace.go jin@k53:~/go-test$ ./namespace run sh p pid: 4342 c p pid: 0 c pid: 1 / # / # 可以看到现在不用root权限就可以运行了。docker 也不需要root权限就能运行呢，向docker又前进了一小步，而且，容器内是root，容器外，sh其实是以普通用户执行的，安全性又得到了保证。其实这种安全性是很粗糙的，关于容器的安全性，是一个比较有意思的话题，后面也许会单独谈谈。</div><div class="post-footer">
    <a href="/zh/linux/namespace_improve/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/linux/' class="post-tag">Linux</a><a href='/zh/tags/docker/' class="post-tag">Docker</a></div></div>
</article>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><h2 class="single-title" itemprop="name headline"><a href="/zh/golang/golang%E9%AB%98%E7%BA%A7/">Golang高级001</a>
  </h2><div class="post-meta"><span class="post-author"><a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer author" class="author"><img loading="lazy" src="https://avatars.githubusercontent.com/u/36183188?s=400&amp;u=69ec665b3e4ffcc40a98072d56fbaa5b044c5968&amp;v=4" alt="caijin" data-title="caijin" width="20" height="20" class="avatar" style="background: url(/images/loading.min.svg) no-repeat center;" onload="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}this.dataset.lazyloaded='';" onerror="this.title=this.dataset.title;for(const i of ['style', 'data-title','onerror','onload']){this.removeAttribute(i);}"/>&nbsp;caijin</a></span>&nbsp;<span class="post-publish" title='2019-08-14 19:33:19'></span><span class="post-included-in">&nbsp;</span></div><div class="content"> CSP模型，goroutine调度
csp并发模型：csp并发模型不同于一般的多线程通过共享内存进行通信的方式，而是采用“通过通信进行共享，而不是通过共享进行通信”，用于多个独立并发的实体通过共享通信的channel进行通信的并发模型。csp中channel是第一类对象，它不关注发送消息的实体，而是关注发送消息时使用的channel。
goroutine调度：
M：内核线程
P：cpu的一个核
G：goroutine
控制并发的方式
通过channel进行并发控制 通过sync包的WaitGroup进行并发控制 通过context进行并发控制 GC
gc算法：三色标记法（标记-清除）
流出如下：
初始把所有对象标记为白色 从全局变量和栈变量作为GC root，开始找到所有可达对象，标记为灰色，放入待处理队列 遍历灰色对象队列，将其引用的对象标记为灰色放入队列，自身标记为黑色，并从队列中删除 循环往复上一步，直到灰色队列为空 剩余的白色对象即为垃圾对象，执行清理工作 触发GC的条件：
辅助GC：分配内存时，会判断当前heap内存分配量是否达到触发一轮GC的阀值（每轮GC完成后，阀值会被动态设置），如果超过阀值，则启动一轮GC 显式调用runtime.GC()强制启动一轮GC sysmon是运行时的守护进程，当超过 forcegcperiod (2分钟)没有运行GC会启动一轮GC </div><div class="post-footer">
    <a href="/zh/golang/golang%E9%AB%98%E7%BA%A7/"></a><div class="post-tags"><i class="fa-solid fa-tags fa-fw me-1" aria-hidden="true"></i><a href='/zh/tags/golang/' class="post-tag">Golang</a></div></div>
</article>
<ul class="pagination"><li class="page-item">
          <span class="page-link">
            <a href="/zh/">1</a>
          </span>
        </li><li class="page-item active">
          <span class="page-link">
            <a href="/zh/page/2/">2</a>
          </span>
        </li><li class="page-item">
          <span class="page-link">
            <a href="/zh/page/3/">3</a>
          </span>
        </li></ul></div></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered order-2">
        </div><div class="footer-line copyright order-1" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">
              <a href="https://caijin.dev"target="_blank" rel="external nofollow noopener noreferrer">caijin</a></span><span class="license footer-divider">MIT</span></div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label=""><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric d-none">0%</span>
        </div></div><div id="mask"></div><noscript>
    <div class="noscript-warning"></div>
  </noscript>
</div><link rel="preload" href="/lib/katex/katex.min.css" as="style" onload="this.removeAttribute('onload');this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/lib/katex/katex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script src="/lib/sharer/sharer.min.js" async defer></script><script src="/lib/katex/katex.min.js" defer></script><script src="/lib/katex/auto-render.min.js" defer></script><script src="/lib/katex/copy-tex.min.js" defer></script><script src="/lib/katex/mhchem.min.js" defer></script><script src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/js/flyfish.js" defer></script><script>window.config={"code":{"copyTitle":"","editLockTitle":"","editUnLockTitle":"","editable":true,"maxShownLines":10},"cookieconsent":{"content":{"dismiss":"","link":"","message":""},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"version":"v0.3.9"};</script><script src="/js/theme.min.js" defer></script></body>
</html>
