<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
  <channel>
    <title>Kafka - tag - *&lt;^_^&gt;*</title>
    <link>https://caijin.dev/zh/tags/kafka/</link>
    <description>Kafka - tag | *&lt;^_^&gt;*</description>
    <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><copyright>xxxx</copyright><lastBuildDate>Sat, 02 May 2020 20:18:42 &#43;0800</lastBuildDate><atom:link href="https://caijin.dev/zh/tags/kafka/" rel="self" type="application/rss+xml" /><item>
  <title>kafkaç®€ä»‹</title>
  <link>https://caijin.dev/zh/kafka/kafka/</link>
  <pubDate>Sat, 02 May 2020 20:18:42 &#43;0800</pubDate>
  <author>caijin</author>
  <guid>https://caijin.dev/zh/kafka/kafka/</guid>
  <description><![CDATA[Kafka ä¸€ã€åŸºæœ¬æ¦‚å¿µ kafka clusterï¼škafkaé›†ç¾¤ï¼Œä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ªå®žä¾‹ï¼ˆbrokerï¼‰ç»„æˆï¼Œé€šè¿‡zookeeperè¿›è¡Œå…ƒæ•°æ®ï¼ˆbrokerIDã€broker åœ°å€ç­‰ä¿¡æ¯ï¼Œpartitionçš„leaderã€followerä¿¡æ¯ç­‰ï¼‰å…±äº«ä¸ŽåŒæ­¥ brokerï¼škafkaé›†ç¾¤ä¸­çš„ä¸€ä¸ªkafkaæœåŠ¡å®žä¾‹ï¼Œé›†ç¾¤å†…æ¯ä¸ªbrokeréƒ½æœ‰ä¸€ä¸ªä¸é‡å¤çš„ç¼–å·ï¼Œå¦‚broker-0ã€broker-1 producerï¼šæ¶ˆæ¯ç”Ÿäº§è€… topicï¼šæ¶ˆæ¯ä¸»é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ¶ˆæ¯åˆ†ç±»ï¼Œä¸ºé€»è¾‘æ¦‚å¿µã€‚Kafkaçš„æ¶ˆæ¯å°±ä¿å­˜åœ¨topicï¼Œæ¯ä¸ªbrokerä¸Šéƒ½å¯ä»¥åˆ›å»ºå¤šä¸ªtopicã€‚ partitionï¼štopicçš„åˆ†åŒºï¼Œæ¯ä¸ªtopicå¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºçš„ä½œç”¨æ˜¯åšè´Ÿè½½ï¼Œæé«˜Kafkaçš„åžåé‡ã€‚åŒä¸€ä¸ªtopicåœ¨ä¸åŒåˆ†åŒºçš„æ•°æ®æ˜¯ä¸é‡å¤çš„ï¼Œpartitionçš„è¡¨çŽ°å½¢å¼å°±æ˜¯ä¸€ä¸ªä¸ªæ–‡ä»¶å¤¹ï¼Œä¸ºç‰©ç†æ¦‚å¿µã€‚ replicationï¼šåˆ†åŒºçš„å‰¯æœ¬ï¼Œå‰¯æœ¬çš„ä½œç”¨å°±æ˜¯æé«˜Kafkaçš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚åŒä¸€ä¸ªpartitionæœ‰å¤šä¸ªreplicationçš„æƒ…å†µä¸‹ï¼Œä¼šé€šè¿‡zookeeperé€‰å‡ºä¸€ä¸ªleaderï¼Œå…¶ä½™çš„ä¸ºfollowerï¼Œproducer/consumer è¯»å†™partitionçš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡leaderè¿›è¡Œçš„ã€‚å½“leaderä¸å¯ç”¨æ—¶ï¼Œä¼šé€‰æ‹©ä¸€ä¸ªfolloweræˆä¸ºleaderã€‚åœ¨Kafkaä¸­ï¼Œé»˜è®¤çš„æœ€å¤§å‰¯æœ¬æ•°é‡æ˜¯10ä¸ªï¼Œè€Œä¸”å‰¯æœ¬çš„æ•°é‡ä¸èƒ½è¶…è¿‡brokeræ•°é‡ consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€… consumer groupï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ç»„ã€‚ä¸ºäº†æé«˜Kafkaçš„åžåé‡ã€‚å¯ä»¥å°†å¤šä¸ªconsumerç»„æˆä¸€ä¸ªgroupï¼ŒåŒä¸€ä¸ªpartitionæ•°æ®åªèƒ½è¢«groupä¸­çš„ä¸€ä¸ªconsumeræ¶ˆè´¹ã€‚åŒä¸€ä¸ªgroupé‡Œçš„consumerå¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ªtopicçš„ä¸åŒåˆ†åŒºçš„æ•°é‡ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ä¿è¯ï¼ŒåŒä¸€æ¶ˆæ¯ï¼Œä¸ä¼šè¢«é‡å¤æ¶ˆè´¹ äºŒã€Kafkaæ ¸å¿ƒè§„åˆ™ å·¥ä½œæµç¨‹
producerå…ˆä»Žé›†ç¾¤ä¸­èŽ·å–åˆ†åŒºçš„leader producerå°†æ¶ˆæ¯å‘é€ç»™leader leaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶ followerä»Žleader pull æ¶ˆæ¯ followerå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ–‡ä»¶åŽï¼Œå‘leaderå‘é€ACK leaderæ”¶åˆ°æ‰€æœ‰å‰¯æœ¬çš„ACKåŽï¼Œå‘producerå‘é€ACK æ¯æ¡æ¶ˆæ¯æ˜¯è¿½åŠ åˆ°åˆ†åŒºä¸­ï¼Œé¡ºåºå†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥ä¿è¯åŒä¸€åˆ†åŒºçš„æ•°æ®æ˜¯æœ‰åºçš„ produceré‡‡ç”¨pushæ¨¡å¼å°†æ¶ˆæ¯å‘å¸ƒåˆ°broker followeræ˜¯ä¸»åŠ¨åŽ»leader pullæ¶ˆæ¯è¿›è¡ŒåŒæ­¥çš„ producerå¦‚ä½•ç¡®å®šæ•°æ®è¯¥å†™åˆ°é‚£ä¸ªpartition partitionåœ¨å†™å…¥çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦å†™å…¥çš„partitionï¼›å¦‚æžœæŒ‡å®šï¼Œåˆ™å†™å…¥å¯¹åº”çš„partition å¦‚æžœæ²¡æœ‰æŒ‡å®špartitionï¼Œä½†æ˜¯è®¾ç½®äº†keyï¼Œåˆ™ä¼šæ ¹æ®keyçš„å€¼hashåˆ°ä¸€ä¸ªpartition å¦‚æžœæ—¢æ²¡æœ‰partitionï¼Œä¹Ÿæ²¡æœ‰keyï¼Œåˆ™ä¼šè½®è¯¢é€‰å‡ºä¸€ä¸ªpartition å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼šproducerå†™å…¥æ¶ˆæ¯ã€followeråŒæ­¥leaderæ¶ˆæ¯çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›žACKï¼Œé€šè¿‡ACKåº”ç­”æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢ã€‚åœ¨ç”Ÿäº§è€…å‘kafkaå†™æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥è®¾å®šå‚æ•°acksæ¥ç¡®å®škafkaæ˜¯å¦ç¡®è®¤æ”¶åˆ°æ•°æ®ï¼Œè¿™ä¸ªå€¼å¯ä»¥è®¾ç½®ä¸º0ã€1ã€all
0ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusterä¸éœ€è¦ç­‰åˆ°clusterè¿”å›žACKæ¶ˆæ¯ï¼Œæ‰€ä»¥è®¾ç½®è¿™ä¸ªå€¼ä¸èƒ½ç¡®ä¿æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå®‰å…¨æ€§æœ€ä½Žï¼Œä½†æ˜¯æ•ˆçŽ‡æœ€é«˜ 1ä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œåªè¦leaderåº”ç­”å°±å¯ä»¥å‘é€ä¸‹ä¸€æ¡ï¼Œæ‰€ä»¥è¿™ä¸ªè®¾ç½®åªèƒ½ç¡®ä¿å‘é€ç»™leaderæˆåŠŸ allä»£è¡¨produceræ¶ˆæ¯å‘å¾€clusteræ—¶ï¼Œéœ€è¦æ‰€æœ‰çš„followeréƒ½å®Œæˆä»ŽleaderåŒæ­¥ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€æ¡ï¼Œç¡®ä¿leaderå‘é€æˆåŠŸå¹¶ä¸”æ‰€æœ‰followeréƒ½å®Œæˆå¤‡ä»½ã€‚å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯æ•ˆçŽ‡æœ€ä½Ž æ•°æ®ä¿å­˜
partitionç»“æž„ï¼šæ¯ä¸ªpartitionæ–‡ä»¶å¤¹ç”±å¤šä¸ªsegmentæ–‡ä»¶ç»„æˆï¼Œæ¯ç»„segmentæ–‡ä»¶åŒ…å«.indexã€.logæ–‡ã€.timeindexä¸‰ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­.indexã€.logæ–‡ä»¶ä¸ºç´¢å¼•æ–‡ä»¶ï¼Œlogæ–‡ä»¶å°±æ˜¯å­˜å‚¨messageçš„åœ°æ–¹ã€‚Kafkaå°±æ˜¯åˆ©ç”¨segment+indexçš„æ–¹å¼è§£å†³æŸ¥è¯¢æ•ˆçŽ‡ä½Žé—®é¢˜ messageç»“æž„ï¼šmessageä¸»è¦åŒ…å«æ¶ˆæ¯ä½“ã€æ¶ˆæ¯å¤§å°ã€offsetã€åŽ‹ç¼©ç±»åž‹ç­‰ä¿¡æ¯ å­˜å‚¨ç­–ç•¥ï¼šæ— è®ºmessageæ˜¯å¦è¢«æ¶ˆè´¹ï¼ŒKafkaéƒ½ä¼šä¿å­˜æ‰€æœ‰æ¶ˆæ¯ï¼Œå¯¹äºŽæ—§æ•°æ®åˆ é™¤ç­–ç•¥æœ‰ä¸¤ç§ï¼šåŸºäºŽæ—¶é—´ï¼Œé»˜è®¤7å¤©ï¼›åŸºäºŽå¤§å°ï¼Œé»˜è®¤1GBã€‚ consumer groupä¸­consumerå’Œpartitionçš„å…³ç³»ï¼š
ä¸€ä¸ªconsumerå¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionä¸­çš„æ•°æ® ä¸€ä¸ªpartitionåªèƒ½è¢«ä¸€ä¸ªconsumeræ¶ˆè´¹ ä¸‰ã€Kafkaåžåé‡å¤§çš„åŽŸå›  å››ã€QA leaderçš„é€‰ä¸¾
kafkaä¸æ˜¯å¤šæ•°æŠ•ç¥¨é€‰ä¸¾leaderã€‚kafkaåŠ¨æ€ç»´æŠ¤ä¸€ç»„åŒæ­¥leaderæ•°æ®çš„å‰¯æœ¬ï¼ˆISR in-sync-replicationï¼‰ï¼Œåªæœ‰è¿™ä¸ªç»„çš„æˆå‘˜æ‰æœ‰èµ„æ ¼å½“é€‰leaderï¼Œkafkaå‰¯æœ¬å†™å…¥ä¸è¢«è®¤ä¸ºæ˜¯å·²æäº¤ï¼Œç›´åˆ°æ‰€æœ‰çš„åŒæ­¥å‰¯æœ¬å·²ç»æŽ¥æ”¶æ‰è®¤ä¸ºã€‚è¿™ç»„ISRä¿å­˜åœ¨zookeeperï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ISRä¸­çš„ä»»ä½•å‰¯æœ¬éƒ½æœ‰èµ„æ ¼å½“é€‰leaderï¼Œè¿™æ˜¯kafkaçš„ä½¿ç”¨æ¨¡åž‹ï¼Œæœ‰å¤šä¸ªåˆ†åŒºå’Œç¡®ä¿leaderå¹³è¡¡æ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚æœ‰äº†è¿™ä¸ªæ¨¡åž‹ï¼ŒISRå’Œf+1å‰¯æœ¬ï¼Œkafkaçš„ä¸»é¢˜å¯ä»¥å®¹å¿få¤±è´¥è€Œä¸ä¼šä¸¢å¤±å·²æäº¤çš„æ¶ˆæ¯ã€‚
æˆä¸ºISRåˆ—è¡¨ä¸­çš„ä¸€å‘˜ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š
å‰¯æœ¬èŠ‚ç‚¹å¿…é¡»èƒ½ä¸Žzookeeperä¿æŒä¼šè¯ï¼ˆå¿ƒè·³æœºåˆ¶ðŸ’—ï¼‰ å‰¯æœ¬èƒ½å¤Ÿå¤åˆ¶leaderä¸Šçš„æ‰€æœ‰å†™æ“ä½œï¼Œå¹¶ä¸”ä¸èƒ½è½åŽå¤ªå¤šï¼ˆå¡ä½æˆ–æ»žåŽçš„å‰¯æœ¬ç”±replica.lag.time.max.msé…ç½®ï¼‰ ä¸€æ—¦followerä»ŽleaderåŒæ­¥æ•°æ®çš„å»¶è¿Ÿè¶…è¿‡é˜€å€¼ï¼Œleaderå°±ä¼šæŠŠå®ƒä»ŽISRä¸­å‰”é™¤ï¼Œæ”¾å…¥OSRï¼Œæ–°åŠ å…¥çš„followerä¹Ÿä¼šåŠ å…¥OSR
AR(assigned replicas) = ISR+OSR (out of-sync-replicas)
å¦‚ä½•ä¿è¯å·²æäº¤çš„ä¿¡æ¯ä¸ä¸¢å¤±
replication+leaderé€‰ä¸¾æœºåˆ¶]]></description>
</item>
</channel>
</rss>
